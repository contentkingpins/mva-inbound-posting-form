<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Claim Connectors</title>
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    
    <!-- Preconnect to CDNs -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Icons -->
    <link rel="stylesheet" href="https://unpkg.com/lucide@latest/dist/lucide.css">
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    
    <!-- CountUp.js for number animations -->
    <script src="https://unpkg.com/countup.js@2.8.0/dist/countUp.umd.js"></script>
    
    <!-- JSZip for creating downloadable publisher packages -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    
    <!-- MASTER DARK THEME - Single source of truth -->
    <link rel="stylesheet" href="css/master-dark-theme.css">
    
    <!-- FALLBACK: Inline critical dark theme styles for instant loading -->
    <style>
    /* Critical dark theme styles - loads immediately */
    :root {
        --bg-primary: #0F0F23;
        --bg-secondary: #1A1A2E;
        --bg-accent: #16213E;
        --bg-glass: rgba(26, 26, 46, 0.95);
        --text-primary: #FFFFFF;
        --text-secondary: #CBD5E1;
        --text-muted: #9CA3AF;
        --accent-blue: #3B82F6;
        --accent-purple: #8B5CF6;
        --success: #10B981;
        --warning: #F59E0B;
        --error: #EF4444;
        --border-subtle: rgba(139, 92, 246, 0.2);
        --border-accent: rgba(59, 130, 246, 0.3);
        --font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        --space-4: 1rem;
        --space-6: 1.5rem;
        --radius-md: 0.5rem;
        --radius-lg: 0.75rem;
        --radius-xl: 1rem;
        --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.5);
        --transition-base: 0.3s ease;
    }
    
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
        font-family: var(--font-family);
        background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
        color: var(--text-primary);
        min-height: 100vh;
        line-height: 1.6;
    }
    
    .admin-header {
        background: var(--bg-glass);
        backdrop-filter: blur(20px);
        border-bottom: 1px solid var(--border-subtle);
        padding: var(--space-4) var(--space-6);
        position: sticky;
        top: 0;
        z-index: 100;
    }
    
    .header-content {
        display: flex;
        justify-content: space-between;
        align-items: center;
        max-width: 1400px;
        margin: 0 auto;
    }
    
    .header-title {
        color: var(--accent-purple);
        font-size: 1.5rem;
        font-weight: 700;
        display: flex;
        align-items: center;
        gap: 0.75rem;
    }
    
    .admin-main {
        max-width: 1400px;
        margin: 0 auto;
        padding: var(--space-6);
        min-height: calc(100vh - 80px);
    }
    
    .quick-stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 1.25rem;
        margin-bottom: 2rem;
    }
    
    .stat-card {
        background: var(--bg-glass);
        backdrop-filter: blur(20px);
        border: 1px solid var(--border-subtle);
        border-radius: var(--radius-lg);
        padding: 1.25rem;
        transition: all var(--transition-base);
        position: relative;
        overflow: hidden;
    }

    .stat-card:hover {
        border-color: var(--accent-purple);
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(139, 92, 246, 0.2);
    }

    .stat-icon {
        font-size: 2rem;
        margin-bottom: 1rem;
        color: var(--accent-purple);
    }

    .stat-content {
        flex: 1;
    }

    .stat-value {
        font-size: 2.5rem;
        font-weight: 800;
        color: var(--text-primary);
        line-height: 1;
        margin-bottom: 0.5rem;
    }

    .stat-label {
        font-size: 0.875rem;
        color: var(--text-secondary);
        text-transform: uppercase;
        letter-spacing: 0.5px;
        font-weight: 600;
        margin-bottom: 0.75rem;
    }

    .stat-change {
        font-size: 0.75rem;
        font-weight: 500;
        padding: 0.25rem 0.5rem;
        border-radius: var(--radius-md);
        background: rgba(16, 185, 129, 0.1);
        color: var(--success);
        display: inline-block;
        margin-bottom: 1rem;
    }

    .stat-change.positive {
        background: rgba(16, 185, 129, 0.1);
        color: var(--success);
    }

    .stat-change.negative {
        background: rgba(239, 68, 68, 0.1);
        color: var(--error);
    }

    .stat-expand {
        position: absolute;
        top: 1rem;
        right: 1rem;
        width: 32px;
        height: 32px;
        background: rgba(139, 92, 246, 0.1);
        border: 1px solid rgba(139, 92, 246, 0.2);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--accent-purple);
        font-size: 0.875rem;
        cursor: pointer;
        transition: all var(--transition-base);
    }

    .stat-expand:hover {
        background: var(--accent-purple);
        color: white;
        transform: scale(1.1);
    }

    .stat-visual,
    .stat-sparkline,
    .revenue-forecast-mini {
        margin-top: 1rem;
        height: 40px;
        position: relative;
    }

    .agent-performance-mini {
        display: flex;
        gap: 2px;
        align-items: end;
        height: 30px;
        margin-top: 0.5rem;
    }

    .agent-bar {
        width: 8px;
        background: linear-gradient(to top, var(--accent-purple), var(--accent-blue));
        border-radius: 2px;
        height: calc(var(--height) * 0.3);
        transition: all var(--transition-base);
    }

    .conversion-visual {
        display: flex;
        align-items: center;
        justify-content: center;
        margin-top: 1rem;
    }

    .progress-ring {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        background: conic-gradient(var(--accent-purple) calc(var(--progress) * 1%), rgba(139, 92, 246, 0.1) 0);
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
    }

    .progress-ring::before {
        content: attr(data-percent);
        position: absolute;
        font-size: 0.75rem;
        font-weight: 700;
        color: var(--text-primary);
    }
    
    .btn {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.75rem 1rem;
        border: none;
        border-radius: 0.5rem;
        font-size: 0.875rem;
        font-weight: 500;
        cursor: pointer;
        transition: all var(--transition-base);
        text-decoration: none;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }
    
    .btn:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }
    
    .btn-primary {
        background: linear-gradient(135deg, var(--accent-blue), #2563EB);
        color: white;
        border: 1px solid var(--accent-blue);
    }
    
    .btn-primary:hover {
        background: linear-gradient(135deg, #2563EB, #1D4ED8);
        box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
    }
    
    .btn-secondary {
        background: linear-gradient(135deg, var(--bg-accent), var(--bg-secondary));
        color: var(--text-primary);
        border: 1px solid var(--border-accent);
    }
    
    .btn-secondary:hover {
        background: linear-gradient(135deg, var(--bg-secondary), var(--bg-accent));
        border-color: var(--accent-purple);
        box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);
    }
    
    .btn-success {
        background: linear-gradient(135deg, var(--success), #059669);
        color: white;
        border: 1px solid var(--success);
    }
    
    .btn-success:hover {
        background: linear-gradient(135deg, #059669, #047857);
        box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);
    }
    
    .btn-info {
        background: linear-gradient(135deg, #3B82F6, #2563EB);
        color: white;
        border: 1px solid #3B82F6;
    }
    
    .btn-info:hover {
        background: linear-gradient(135deg, #2563EB, #1D4ED8);
        box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
    }
    
    .btn-warning {
        background: linear-gradient(135deg, var(--warning), #D97706);
        color: white;
        border: 1px solid var(--warning);
    }
    
    .btn-warning:hover {
        background: linear-gradient(135deg, #D97706, #B45309);
        box-shadow: 0 4px 12px rgba(245, 158, 11, 0.4);
    }
    
    .btn-outline {
        background: transparent;
        border: 2px solid var(--accent-blue);
        color: var(--accent-blue);
        padding: 0.75rem 1.5rem;
        border-radius: var(--radius-md);
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        cursor: pointer;
        transition: all var(--transition-base);
        width: 100%;
        justify-content: center;
        position: relative;
        overflow: hidden;
    }
    
    .btn-outline::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(59, 130, 246, 0.1), transparent);
        transition: left 0.5s ease;
    }
    
    .btn-outline:hover {
        background: var(--accent-blue);
        color: white;
        transform: translateY(-1px);
        box-shadow: 0 8px 20px rgba(59, 130, 246, 0.3);
    }
    
    .btn-outline:hover::before {
        left: 100%;
    }
    
    .btn-sm {
        padding: 0.5rem 1rem;
        font-size: 0.8rem;
        font-weight: 600;
        white-space: nowrap;
    }

    /* GLOBAL HELPER FUNCTIONS & FIXES */
    .btn-info {
        background: #3B82F6 !important;
        color: white;
        border: none;
    }

    .btn-info:hover {
        background: #2563EB !important;
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
    }

    /* ENSURE MODALS WORK PROPERLY */
    .modal-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        backdrop-filter: blur(10px);
        z-index: 10000;
        align-items: center;
        justify-content: center;
    }

    .modal-overlay.active {
        display: flex !important;
    }

    .glass-modal {
        background: var(--bg-glass);
        backdrop-filter: blur(20px);
        border: 1px solid var(--border-subtle);
        border-radius: var(--radius-xl);
        box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
        max-width: 500px;
        width: 90%;
        max-height: 90vh;
        overflow-y: auto;
    }

    .modal-header {
        padding: 2rem 2rem 1rem;
        border-bottom: 1px solid var(--border-subtle);
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .modal-title {
        color: var(--text-primary);
        font-size: 1.5rem;
        font-weight: 700;
        margin: 0;
    }

    .modal-close {
        background: none;
        border: none;
        color: var(--text-muted);
        font-size: 2rem;
        cursor: pointer;
        padding: 0;
        line-height: 1;
        transition: color var(--transition-base);
    }

    .modal-close:hover {
        color: var(--text-primary);
    }

    .modal-body {
        padding: 2rem;
    }

    .modal-footer {
        padding: 1rem 2rem 2rem;
        display: flex;
        gap: 1rem;
        justify-content: flex-end;
    }

    /* RESPONSIVE MODAL */
    @media (max-width: 768px) {
        .glass-modal {
            width: 95%;
            margin: 1rem;
        }
        
        .modal-header,
        .modal-body,
        .modal-footer {
            padding: 1.5rem;
        }
        
        .modal-footer {
            flex-direction: column;
        }
        
        .modal-footer .btn {
            width: 100%;
        }
    }

    /* ACTIVITY FEED IMPROVEMENTS */
    .activity-feed {
        padding: 1.5rem 2rem 2rem;
        max-height: 400px;
        overflow-y: auto;
    }

    .activity-item {
        display: flex;
        align-items: flex-start;
        gap: 1rem;
        padding: 1rem;
        margin-bottom: 1rem;
        background: var(--bg-secondary);
        border-radius: var(--radius-md);
        border-left: 3px solid var(--accent-purple);
        transition: all var(--transition-base);
        cursor: pointer;
        position: relative;
    }

    .activity-item:hover {
        background: var(--bg-accent);
        transform: translateX(4px);
    }

    .activity-icon {
        width: 40px;
        height: 40px;
        background: rgba(139, 92, 246, 0.1);
        border: 2px solid rgba(139, 92, 246, 0.2);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.125rem;
        flex-shrink: 0;
    }

    .activity-content {
        flex: 1;
    }

    .activity-text {
        color: var(--text-primary);
        font-size: 0.9rem;
        font-weight: 500;
        margin-bottom: 0.25rem;
    }

    .activity-time {
        color: var(--text-muted);
        font-size: 0.75rem;
        font-weight: 500;
    }

    .activity-expand {
        width: 24px;
        height: 24px;
        background: var(--accent-purple);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 1rem;
        font-weight: 700;
        flex-shrink: 0;
        transition: all var(--transition-base);
    }

    .activity-item.expanded .activity-expand {
        background: var(--accent-blue);
        transform: rotate(45deg);
    }

    .activity-details {
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        background: var(--bg-accent);
        border: 1px solid var(--border-subtle);
        border-radius: var(--radius-md);
        padding: 1rem;
        margin-top: 0.5rem;
        opacity: 0;
        visibility: hidden;
        transform: translateY(-10px);
        transition: all var(--transition-base);
        z-index: 10;
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
    }

    .activity-item.expanded .activity-details {
        opacity: 1;
        visibility: visible;
        transform: translateY(0);
    }

    .activity-details p {
        color: var(--text-secondary);
        font-size: 0.875rem;
        line-height: 1.5;
        margin: 0;
    }
    </style>
    
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Build-Time Injected Configuration -->
    <script>
    window.APP_CONFIG = {
        "userPoolId": "us-east-1_lhc964tLD",
        "clientId": "5t6mane4fnvineksoqb4ta0iu1",
        "apiEndpoint": "https://9qtb4my1ij.execute-api.us-east-1.amazonaws.com/prod",
        "apiUrl": "https://9qtb4my1ij.execute-api.us-east-1.amazonaws.com/prod",
        "apiKey": "",
        "buildTime": "2025-05-29T01:13:52.266Z",
        "buildEnv": "production"
    };
    window.preloadedConfig = window.APP_CONFIG;
    console.log('🔧 Configuration injected at build time - no external loading needed');
    
    // 🎨 DARK THEME ENFORCER - Ensures dark theme always loads
    document.addEventListener('DOMContentLoaded', function() {
        console.log('🎨 Dark Theme Enforcer - Checking CSS...');
        
        // Test if external CSS loaded by checking for custom properties
        const testElement = document.createElement('div');
        testElement.style.display = 'none';
        document.body.appendChild(testElement);
        
        const computedStyle = getComputedStyle(testElement);
        const bgPrimary = computedStyle.getPropertyValue('--bg-primary');
        
        if (!bgPrimary || bgPrimary.trim() === '') {
            console.warn('⚠️ External CSS not loaded - using inline fallback');
            // The inline CSS will handle it
        } else {
            console.log('✅ Dark theme CSS loaded successfully');
        }
        
        document.body.removeChild(testElement);
        
        // Force dark theme class on body
        document.body.classList.add('dark-theme');
        
        // Apply additional dark theme enforcement
        document.body.style.background = 'linear-gradient(135deg, #0F0F23 0%, #1A1A2E 100%)';
        document.body.style.color = '#FFFFFF';
    });
    </script>
</head>
<body>
    <!-- Header -->
    <header class="admin-header">
        <div class="header-content">
            <div class="header-left">
                <h1 class="header-title">
                    <span class="header-icon">⚡</span>
                    Claim Connectors Admin
                </h1>
                <div class="header-greeting">
                    Good <span id="time-greeting">morning</span>, <span id="admin-name">Admin</span> 
                    <span class="ai-badge">⚡ Powered by Angel Dust OS</span>
                </div>
            </div>
            <div class="header-right">
                <div class="header-date" id="current-date"></div>
                <button class="btn btn-success btn-sm" onclick="openAddAgentModal()">
                    👤 Add Agent
                </button>
                <button class="btn btn-info btn-sm" onclick="openAddPublisherModal()">
                    🏢 Add Publisher
                </button>
                <button class="btn btn-secondary btn-sm" id="refresh-all">🔄 Refresh</button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="admin-main">
        <!-- Quick Stats Grid -->
        <div class="quick-stats-grid">
            <div class="stat-card leads">
                <div class="stat-icon">📋</div>
                <div class="stat-content">
                    <div class="stat-value" id="total-leads">0</div>
                    <div class="stat-label">Total Leads</div>
                    <div class="stat-change positive" id="leads-change">+12% this week</div>
                    <div class="stat-sparkline" id="leads-sparkline"></div>
                </div>
                <div class="stat-expand" onclick="expandChart('leads')">📊</div>
            </div>
            
            <div class="stat-card agents">
                <div class="stat-icon">👥</div>
                <div class="stat-content">
                    <div class="stat-value" id="active-agents">0</div>
                    <div class="stat-label">Active Agents</div>
                    <div class="stat-change positive" id="agents-change">3 online now</div>
                    <div class="stat-visual">
                        <div class="agent-performance-mini" id="agent-performance-mini"></div>
                    </div>
                </div>
                <div class="stat-expand" onclick="expandChart('agents')">📊</div>
            </div>
            
            <div class="stat-card conversion">
                <div class="stat-icon">🎯</div>
                <div class="stat-content">
                    <div class="stat-value" id="conversion-rate">0%</div>
                    <div class="stat-label">Close Rate</div>
                    <div class="stat-change positive" id="conversion-change">+5% improvement</div>
                    <div class="conversion-visual">
                        <div class="progress-ring" id="conversion-ring">
                            <div class="progress-fill" id="conversion-fill"></div>
                        </div>
                    </div>
                </div>
                <div class="stat-expand" onclick="expandChart('conversion')">📊</div>
            </div>
            
            <div class="stat-card revenue">
                <div class="stat-icon">💰</div>
                <div class="stat-content">
                    <div class="stat-value" id="monthly-revenue">$0</div>
                    <div class="stat-label">Monthly Revenue</div>
                    <div class="stat-change positive" id="revenue-change">On track</div>
                    <div class="revenue-forecast-mini" id="revenue-forecast-mini"></div>
                </div>
                <div class="stat-expand" onclick="expandChart('revenue')">📊</div>
            </div>
        </div>

        <!-- Expandable Chart Sections -->
        <div class="chart-modal" id="chart-modal">
            <div class="chart-modal-content">
                <div class="chart-modal-header">
                    <h3 id="chart-modal-title">Detailed Analytics</h3>
                    <button class="chart-modal-close" onclick="closeChartModal()">&times;</button>
                </div>
                <div class="chart-modal-body" id="chart-modal-body">
                    <!-- Dynamic chart content will be injected here -->
                </div>
            </div>
        </div>

        <!-- Enhanced Lead Management Overview -->
        <section class="admin-section">
            <div class="section-header">
                <div class="section-title">
                    <span class="section-icon">📊</span>
                    <h2>Lead Management Overview</h2>
                    <div class="real-time-indicator">
                        <span class="pulse-dot"></span>
                        <span class="real-time-text">Real-time</span>
                    </div>
                </div>
                <div class="section-actions">
                    <button class="btn btn-secondary" onclick="exportLeadData()">📊 Export Data</button>
                    <button class="btn btn-primary" onclick="refreshOverview()">🔄 Refresh</button>
                    <button class="btn btn-info" onclick="expandChart('lead-sources')">📈 Lead Sources</button>
                </div>
            </div>
            
            <div class="overview-grid">
                <div class="overview-card available-leads">
                    <h3>🔍 Available Leads</h3>
                    <div class="overview-metric">
                        <span class="metric-value" id="available-leads-count">0</span>
                        <span class="metric-label">Unclaimed leads</span>
                        <div class="metric-trend" id="available-trend">↗️</div>
                    </div>
                    <div class="overview-details">
                        <div class="detail-item">
                            <span class="detail-label">Hot leads:</span>
                            <span class="detail-value hot-leads" id="hot-leads-count">0</span>
                            <div class="hot-indicator"></div>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">This week:</span>
                            <span class="detail-value" id="weekly-leads-count">0</span>
                            <div class="week-progress" id="week-progress"></div>
                        </div>
                    </div>
                    <button class="btn btn-outline" onclick="viewAvailableLeads()">View All</button>
                </div>
                
                <div class="overview-card claimed-leads">
                    <h3>🎯 Claimed Leads</h3>
                    <div class="overview-metric">
                        <span class="metric-value" id="claimed-leads-count">0</span>
                        <span class="metric-label">Being worked</span>
                        <div class="metric-trend" id="claimed-trend">↗️</div>
                    </div>
                    <div class="overview-details">
                        <div class="detail-item">
                            <span class="detail-label">Today:</span>
                            <span class="detail-value" id="todays-claims-count">0</span>
                            <div class="today-progress" id="today-progress"></div>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Avg. response:</span>
                            <span class="detail-value" id="avg-response-time">0 min</span>
                            <div class="response-indicator" id="response-indicator"></div>
                        </div>
                    </div>
                    <button class="btn btn-outline" onclick="viewClaimedLeads()">View All</button>
                </div>
                
                <div class="overview-card agent-performance">
                    <h3>🏆 Agent Performance</h3>
                    <div class="overview-metric">
                        <span class="metric-value" id="top-agent-claims">0</span>
                        <span class="metric-label">Top agent claims</span>
                        <div class="metric-trend" id="performance-trend">↗️</div>
                    </div>
                    <div class="overview-details">
                        <div class="detail-item">
                            <span class="detail-label">Best performer:</span>
                            <span class="detail-value" id="top-agent-name">-</span>
                            <div class="performance-star">⭐</div>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Team avg:</span>
                            <span class="detail-value" id="team-avg-claims">0</span>
                            <div class="team-performance-bar" id="team-performance-bar"></div>
                        </div>
                    </div>
                    <button class="btn btn-outline" onclick="expandChart('agent-performance')">View Details</button>
                </div>
            </div>
        </section>

        <!-- Predictive Analytics -->
        <section class="admin-section">
            <div class="section-header">
                <div class="section-title">
                    <span class="section-icon">🔮</span>
                    <h2>Predictive Analytics</h2>
                    <span class="ai-badge">Angel Dust OS</span>
                </div>
                <div class="section-actions">
                    <button class="btn btn-secondary" onclick="showAnalyticsDetails()">📈 Full Report</button>
                </div>
            </div>
            
            <div class="analytics-grid">
                <div class="analytics-card revenue-forecast">
                    <h4>💰 Revenue Forecast</h4>
                    <div class="revenue-forecast-container">
                        <div class="forecast-main">
                            <div class="forecast-amount">
                                <span class="forecast-value" id="revenue-forecast">$0</span>
                                <span class="forecast-period">Next 30 Days</span>
                            </div>
                            <div class="forecast-confidence">
                                <div class="confidence-label">Confidence Level</div>
                                <div class="confidence-bar">
                                    <div class="confidence-fill" style="width: 95%"></div>
                                    <span class="confidence-value" id="forecast-confidence">95%</span>
                                </div>
                            </div>
                        </div>
                        <div class="forecast-insights">
                            <div class="insight-item">
                                <span class="insight-icon">📈</span>
                                <span class="insight-text">Trending upward</span>
                            </div>
                            <div class="insight-item">
                                <span class="insight-icon">🎯</span>
                                <span class="insight-text">On target for Q4</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="analytics-card lead-quality">
                    <h4>⭐ Lead Quality Analysis</h4>
                    <div class="quality-breakdown">
                        <div class="quality-tier hot">
                            <span class="tier-label">Hot</span>
                            <span class="tier-count" id="hot-tier-count">0</span>
                            <span class="tier-percent" id="hot-tier-percent">0%</span>
                        </div>
                        <div class="quality-tier warm">
                            <span class="tier-label">Warm</span>
                            <span class="tier-count" id="warm-tier-count">0</span>
                            <span class="tier-percent" id="warm-tier-percent">0%</span>
                        </div>
                        <div class="quality-tier cold">
                            <span class="tier-label">Cold</span>
                            <span class="tier-count" id="cold-tier-count">0</span>
                            <span class="tier-percent" id="cold-tier-percent">0%</span>
                        </div>
                    </div>
                </div>
                
                <div class="analytics-card performance-insights">
                    <h4>🚀 Performance Insights</h4>
                    <div class="insights-list" id="performance-insights-list">
                        <div class="insight-item">
                            <span class="insight-icon">📊</span>
                            <span class="insight-text">Analyzing performance patterns...</span>
                        </div>
                    </div>
                </div>
                
                <div class="analytics-card trend-analysis">
                    <h4>📈 Trend Analysis</h4>
                    <div class="trend-items" id="trend-analysis-list">
                        <div class="trend-item">
                            <span class="trend-label">Lead Volume:</span>
                            <span class="trend-indicator up">↗️ +15%</span>
                        </div>
                        <div class="trend-item">
                            <span class="trend-label">Response Time:</span>
                            <span class="trend-indicator down">↘️ -8 min</span>
                        </div>
                        <div class="trend-item">
                            <span class="trend-label">Conversion:</span>
                            <span class="trend-indicator up">↗️ +3%</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Recent Activity & Lead Assignment -->
        <div class="admin-grid">
            <section class="admin-section recent-activity">
                <div class="section-header">
                    <div class="section-title">
                        <span class="section-icon">📝</span>
                        <h2>Recent Activity</h2>
                    </div>
                </div>
                
                <div class="activity-feed" id="activity-feed">
                    <div class="activity-item" onclick="expandActivity(this)">
                        <div class="activity-icon">🎯</div>
                        <div class="activity-content">
                            <div class="activity-text">Lead claimed by Sarah</div>
                            <div class="activity-time">2 min ago</div>
                        </div>
                        <div class="activity-expand">+</div>
                        <div class="activity-details">
                            <p>Sarah Johnson successfully claimed lead John Smith (Auto accident case). Lead has been moved to active pipeline for follow-up and qualification.</p>
                        </div>
                    </div>
                    
                    <div class="activity-item" onclick="expandActivity(this)">
                        <div class="activity-icon">📞</div>
                        <div class="activity-content">
                            <div class="activity-text">Contact completed</div>
                            <div class="activity-time">15 min ago</div>
                        </div>
                        <div class="activity-expand">+</div>
                        <div class="activity-details">
                            <p>Mike Davis completed initial contact with Emma Wilson. Medical evaluation scheduled for next week. Case shows strong potential for settlement.</p>
                        </div>
                    </div>
                    
                    <div class="activity-item" onclick="expandActivity(this)">
                        <div class="activity-icon">✅</div>
                        <div class="activity-content">
                            <div class="activity-text">Case qualified</div>
                            <div class="activity-time">1 hour ago</div>
                        </div>
                        <div class="activity-expand">+</div>
                        <div class="activity-details">
                            <p>Robert Brown case has been qualified and approved for representation. All documentation received and case moved to active litigation status.</p>
                        </div>
                    </div>

                    <div class="activity-item" onclick="expandActivity(this)">
                        <div class="activity-icon">📊</div>
                        <div class="activity-content">
                            <div class="activity-text">Target achieved</div>
                            <div class="activity-time">2 hours ago</div>
                        </div>
                        <div class="activity-expand">+</div>
                        <div class="activity-details">
                            <p>Daily revenue target of $125,000 has been reached ahead of schedule. Team performance excellent with 89% conversion rate today.</p>
                        </div>
                    </div>
                </div>
            </section>
            
            <section class="admin-section lead-management">
                <div class="section-header">
                    <div class="section-title">
                        <span class="section-icon">⚙️</span>
                        <h2>Lead Management</h2>
                    </div>
                </div>
                
                <div class="management-actions">
                    <button class="action-btn" onclick="reassignLead()">
                        <span class="btn-icon">🔄</span>
                        <span class="btn-text">Reassign Lead</span>
                    </button>
                    
                    <button class="action-btn" onclick="bulkActions()">
                        <span class="btn-icon">📦</span>
                        <span class="btn-text">Bulk Actions</span>
                    </button>
                    
                    <button class="action-btn" onclick="leadImport()">
                        <span class="btn-icon">📥</span>
                        <span class="btn-text">Import Leads</span>
                    </button>
                    
                    <button class="action-btn" onclick="agentDashboard()">
                        <span class="btn-icon">👤</span>
                        <span class="btn-text">Agent View</span>
                    </button>
                </div>
                
                <div class="quick-filters">
                    <h4>Quick Filters</h4>
                    <div class="filter-buttons">
                        <button class="filter-btn active" data-filter="all">All Leads</button>
                        <button class="filter-btn" data-filter="unclaimed">Unclaimed</button>
                        <button class="filter-btn" data-filter="hot">Hot Leads</button>
                        <button class="filter-btn" data-filter="overdue">Overdue</button>
                    </div>
                </div>
            </section>
        </div>

        <!-- AI Insights Summary -->
        <section class="admin-section ai-summary">
            <div class="section-header">
                <div class="section-title">
                    <span class="section-icon">🤖</span>
                    <h2>AI Intelligence Summary</h2>
                    <span class="ai-badge">Real-time</span>
                </div>
            </div>
            
            <div class="ai-insights-grid">
                <div class="ai-insight-card">
                    <div class="insight-header">
                        <span class="insight-type">🎯 Lead Optimization</span>
                        <span class="insight-score">87%</span>
                    </div>
                    <p class="insight-text" id="lead-optimization-insight">
                        Your team is performing well. Focus on referral leads for highest conversion.
                    </p>
                </div>
                
                <div class="ai-insight-card">
                    <div class="insight-header">
                        <span class="insight-type">📊 Performance Coaching</span>
                        <span class="insight-score">92%</span>
                    </div>
                    <p class="insight-text" id="performance-coaching-insight">
                        Agent response times improved 15%. Consider bonus incentives.
                    </p>
                </div>
                
                <div class="ai-insight-card">
                    <div class="insight-header">
                        <span class="insight-type">🔮 Market Prediction</span>
                        <span class="insight-score">78%</span>
                    </div>
                    <p class="insight-text" id="market-prediction-insight">
                        Expect 20% more leads next week. Prepare additional capacity.
                    </p>
                </div>
            </div>
        </section>
    </main>

    <!-- Floating Action Button -->
    <div class="fab-container">
        <button class="fab" id="mainFab">
            <span class="fab-icon">⚡</span>
        </button>
        <div class="fab-menu" id="fabMenu">
            <button class="fab-action" onclick="agentDashboard()">
                <span>👤</span> Agent View
            </button>
            <button class="fab-action" onclick="expandChart('lead-sources')">
                <span>📈</span> Lead Sources
            </button>
        </div>
    </div>

    <!-- Add Agent Modal -->
    <div class="modal-overlay" id="add-agent-modal">
        <div class="modal glass-modal">
            <div class="modal-header">
                <h3 class="modal-title">Add New Agent</h3>
                <button class="modal-close" onclick="closeModal('add-agent-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Email Address</label>
                    <input type="email" id="new-agent-email" placeholder="agent@example.com" class="form-input">
                </div>
                <div class="form-group">
                    <label>Role</label>
                    <select id="new-agent-role" class="form-input">
                        <option value="agent">Agent - Manage leads</option>
                        <option value="viewer">Viewer - View only</option>
                        <option value="admin">Admin - Full access</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('add-agent-modal')">Cancel</button>
                <button class="btn btn-primary" onclick="handleSendAgentInvite()">Send Invite</button>
            </div>
        </div>
    </div>

    <!-- Add Publisher Modal -->
    <div class="modal-overlay" id="add-publisher-modal">
        <div class="modal glass-modal">
            <div class="modal-header">
                <h3 class="modal-title">Add New Publisher</h3>
                <button class="modal-close" onclick="closeModal('add-publisher-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Publisher Name</label>
                    <input type="text" id="new-publisher-name" placeholder="Publisher Name" class="form-input" required>
                </div>
                <div class="form-group">
                    <label>Contact Email</label>
                    <input type="email" id="new-publisher-email" placeholder="contact@publisher.com" class="form-input" required>
                </div>
                <div class="form-group">
                    <label>Vendor Code</label>
                    <input type="text" id="new-publisher-code" placeholder="AUTO-GENERATED" class="form-input" readonly style="background: var(--bg-accent); color: var(--text-muted);">
                </div>
                <div class="form-group">
                    <label>API Key</label>
                    <input type="text" id="new-publisher-api-key" placeholder="AUTO-GENERATED" class="form-input" readonly style="background: var(--bg-accent); color: var(--text-muted);">
                </div>
                <div class="form-group">
                    <label>Status</label>
                    <select id="new-publisher-status" class="form-input">
                        <option value="active">Active</option>
                        <option value="inactive">Inactive</option>
                        <option value="pending">Pending</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('add-publisher-modal')">Cancel</button>
                <button class="btn btn-primary" onclick="handleCreatePublisher()">Create Publisher</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/smart-lead-router.js"></script>
    <script src="js/predictive-analytics.js"></script>
    <script src="js/api-service.js"></script>
    <script src="admin.js"></script>
    
    <!-- Enhanced Admin JavaScript with AI Integration -->
    <script>
    let aiAssignmentCounter = 0;
    let aiModeEnabled = true;
    
    // GLOBAL HELPER FUNCTIONS - Available immediately
    function generateVendorCode() {
        const prefix = 'PUB';
        const timestamp = Date.now().toString().slice(-6);
        const random = Math.random().toString(36).substr(2, 4).toUpperCase();
        return `${prefix}${timestamp}${random}`;
    }
    
    function generateAPIKey() {
        return 'api_' + Math.random().toString(36).substr(2, 32);
    }

    function addActivityFeedItem(message, type = 'info') {
        const feed = document.getElementById('activity-feed');
        if (!feed) return; // Safety check
        
        const activity = document.createElement('div');
        activity.className = 'activity-item';
        activity.innerHTML = `
            <div class="activity-icon ${type}">
                ${type === 'success' ? '✅' : type === 'error' ? '❌' : type === 'warning' ? '⚠️' : 'ℹ️'}
            </div>
            <div class="activity-content">
                <div class="activity-message">${message}</div>
                <div class="activity-time">${new Date().toLocaleTimeString()}</div>
            </div>
        `;
        
        feed.insertBefore(activity, feed.firstChild);
        
        // Keep only last 20 items
        const items = feed.querySelectorAll('.activity-item');
        if (items.length > 20) {
            items[items.length - 1].remove();
        }
    }

    // MODAL CONTROL FUNCTIONS - Globally accessible
    function openAddAgentModal() {
        console.log('👤 Opening Add Agent modal...');
        const modal = document.getElementById('add-agent-modal');
        if (modal) {
            // Clear previous data
            const emailInput = document.getElementById('new-agent-email');
            const roleInput = document.getElementById('new-agent-role');
            
            if (emailInput) emailInput.value = '';
            if (roleInput) roleInput.value = 'agent';
            
            modal.classList.add('active');
            addActivityFeedItem('👤 Add Agent dialog opened', 'info');
        } else {
            console.error('❌ Add Agent modal not found');
        }
    }

    function openAddPublisherModal() {
        console.log('🏢 Opening Add Publisher modal...');
        const modal = document.getElementById('add-publisher-modal');
        if (modal) {
            // Clear and generate new data
            const nameInput = document.getElementById('new-publisher-name');
            const emailInput = document.getElementById('new-publisher-email');
            const codeInput = document.getElementById('new-publisher-code');
            const keyInput = document.getElementById('new-publisher-api-key');
            const statusInput = document.getElementById('new-publisher-status');
            
            if (nameInput) nameInput.value = '';
            if (emailInput) emailInput.value = '';
            if (codeInput) codeInput.value = generateVendorCode();
            if (keyInput) keyInput.value = generateAPIKey();
            if (statusInput) statusInput.value = 'active';
            
            modal.classList.add('active');
            addActivityFeedItem('🏢 Add Publisher dialog opened', 'info');
        } else {
            console.error('❌ Add Publisher modal not found');
        }
    }

    function closeModal(modalId) {
        const modal = document.getElementById(modalId);
        if (modal) {
            modal.classList.remove('active');
        }
    }

    function handleSendAgentInvite() {
        const email = document.getElementById('new-agent-email').value;
        const role = document.getElementById('new-agent-role').value;
        
        if (!email) {
            alert('Please enter an email address');
            return;
        }
        
        console.log('📧 Sending agent invite:', { email, role });
        
        // Here you would call your API to create the agent
        addActivityFeedItem(`📧 Agent invite sent to ${email}`, 'success');
        closeModal('add-agent-modal');
    }

    function handleCreatePublisher() {
        const name = document.getElementById('new-publisher-name').value;
        const email = document.getElementById('new-publisher-email').value;
        const vendorCode = document.getElementById('new-publisher-code').value;
        const apiKey = document.getElementById('new-publisher-api-key').value;
        const status = document.getElementById('new-publisher-status').value;
        
        if (!name || !email) {
            alert('Please fill in all required fields');
            return;
        }
        
        console.log('🏢 Creating publisher:', { name, email, vendorCode, apiKey, status });
        
        // Generate and download posting instructions and API documentation
        generatePublisherPackage(name, email, vendorCode, apiKey);
        
        // Here you would call your API to create the publisher
        addActivityFeedItem(`🏢 Publisher "${name}" created successfully`, 'success');
        addActivityFeedItem(`📄 Publisher package downloaded for ${name}`, 'info');
        closeModal('add-publisher-modal');
    }

    // Expose functions to global scope immediately
    window.generateVendorCode = generateVendorCode;
    window.generateAPIKey = generateAPIKey;
    window.openAddAgentModal = openAddAgentModal;
    window.openAddPublisherModal = openAddPublisherModal;
    window.closeModal = closeModal;
    window.handleSendAgentInvite = handleSendAgentInvite;
    window.handleCreatePublisher = handleCreatePublisher;
    window.addActivityFeedItem = addActivityFeedItem;

    console.log('✅ All modal functions are now globally accessible');
    
    document.addEventListener('DOMContentLoaded', function() {
        // Auto-generate vendor codes and API keys function definitions moved above
        
        // Handle collapsible sections
        document.querySelectorAll('.section-toggle').forEach(toggle => {
            toggle.addEventListener('click', function() {
                const sectionName = this.dataset.section;
                const content = document.getElementById(sectionName + '-content');
                const icon = this.querySelector('.toggle-icon');
                
                // Toggle active state
                this.classList.toggle('active');
                content.classList.toggle('expanded');
                
                // Rotate icon
                if (this.classList.contains('active')) {
                    icon.textContent = '▲';
                } else {
                    icon.textContent = '▼';
                }
                
                // Load predictive analytics when section is opened
                if (sectionName === 'predictive-analytics' && this.classList.contains('active')) {
                    loadPredictiveAnalytics();
                }
            });
        });
        
        // Handle modals
        document.querySelectorAll('[data-modal]').forEach(trigger => {
            trigger.addEventListener('click', function() {
                const modalId = this.dataset.modal;
                const modal = document.getElementById(modalId);
                if (modal) {
                    modal.classList.toggle('active');
                }
            });
        });
        
        // Handle modal close buttons
        document.querySelectorAll('.modal-close').forEach(closeBtn => {
            closeBtn.addEventListener('click', function() {
                const modal = this.closest('.modal-overlay');
                if (modal) {
                    modal.classList.remove('active');
                }
            });
        });
        
        // Handle FAB menu (simplified)
        const mainFab = document.getElementById('mainFab');
        if (mainFab) {
            mainFab.addEventListener('click', function() {
                document.querySelector('.fab-container').classList.toggle('active');
            });
        }
        
        // Close modals when clicking outside
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('modal-overlay')) {
                e.target.classList.remove('active');
            }
        });
        
        // Update date and time
        function updateDateTime() {
            const now = new Date();
            const hour = now.getHours();
            let greeting = 'morning';
            
            if (hour >= 12 && hour < 17) greeting = 'afternoon';
            else if (hour >= 17) greeting = 'evening';
            
            const greetingEl = document.getElementById('time-greeting');
            const dateEl = document.getElementById('current-date');
            
            if (greetingEl) greetingEl.textContent = greeting;
            if (dateEl) {
                dateEl.textContent = now.toLocaleDateString('en-US', {
                    weekday: 'long',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
            }
        }
        
        updateDateTime();
        setInterval(updateDateTime, 60000); // Update every minute
        
        // Initialize AI features
        initializeAIFeatures();
        
        // Initialize predictive analytics
        initializePredictiveAnalytics();
        
        // Initialize with some mock data
        setTimeout(() => {
            addActivityFeedItem('System ready', 'success');
        }, 2000);
        
        console.log('🎯 Enhanced admin dashboard initialized with AI features');
    });

    // AI Feature Functions
    function initializeAIFeatures() {
        updateAIMetrics();
        setInterval(updateAIMetrics, 10000); // Update every 10 seconds
        
        // Simulate some AI activity
        setTimeout(() => {
            addAIAssignment({
                leadName: 'Jane Smith',
                agentName: 'Sarah Johnson',
                score: 95,
                time: '2 min ago'
            });
        }, 5000);
    }

    async function updateAIMetrics() {
        try {
            if (window.smartLeadRouter) {
                const queueStatus = await window.smartLeadRouter.getQueueStatus();
                const performanceMetrics = await window.smartLeadRouter.getPerformanceMetrics();
                
                document.getElementById('ai-queue-status').textContent = 
                    queueStatus.size > 0 ? `${queueStatus.size} waiting` : 'All assigned';
                document.getElementById('ai-assignment-time').textContent = 
                    `${performanceMetrics.averageAssignmentTime}s`;
                document.getElementById('ai-assignments').textContent = aiAssignmentCounter;
            }
        } catch (error) {
            console.error('Failed to update AI metrics:', error);
        }
    }

    function testAIAssignment() {
        // Generate a test lead
        const testLead = {
            first_name: 'Test',
            last_name: 'Lead',
            email: 'test@example.com',
            phone_home: '(555) 123-4567',
            state: 'CA',
            zip_code: '90210',
            source: 'website',
            lead_value: 5000,
            notes: 'AI test assignment'
        };

        addActivityFeedItem('🤖 Testing AI assignment system...', 'info');

        // Process through AI
        window.smartLeadRouter.assignLeadIntelligently(testLead)
            .then(assignment => {
                addAIAssignment({
                    leadName: `${testLead.first_name} ${testLead.last_name}`,
                    agentName: assignment.agentName || 'Queued',
                    score: assignment.agentScore?.total || 'N/A',
                    time: 'Just now'
                });
                
                aiAssignmentCounter++;
                updateAIMetrics();
                
                addActivityFeedItem(
                    `✅ AI assigned ${testLead.first_name} ${testLead.last_name} to ${assignment.agentName || 'queue'}`,
                    'success'
                );
            })
            .catch(error => {
                addActivityFeedItem('❌ AI assignment test failed', 'error');
            });
    }

    function addAIAssignment(assignment) {
        const listContainer = document.getElementById('ai-assignment-list');
        
        // Remove empty message
        const emptyMessage = listContainer.querySelector('.ai-assignment-empty');
        if (emptyMessage) {
            emptyMessage.remove();
        }
        
        const assignmentElement = document.createElement('div');
        assignmentElement.className = 'ai-assignment-item';
        assignmentElement.innerHTML = `
            <div class="ai-assignment-info">
                <div class="ai-assignment-lead">${assignment.leadName}</div>
                <div class="ai-assignment-agent">→ ${assignment.agentName}</div>
            </div>
            <div class="ai-assignment-metrics">
                <div class="ai-assignment-score">${assignment.score}/100</div>
                <div class="ai-assignment-time">${assignment.time}</div>
            </div>
        `;
        
        listContainer.insertBefore(assignmentElement, listContainer.firstChild);
        
        // Keep only last 10 assignments
        const assignments = listContainer.querySelectorAll('.ai-assignment-item');
        if (assignments.length > 10) {
            assignments[assignments.length - 1].remove();
        }
    }

    function viewAIInsights() {
        // AI demo removed per user request
        addActivityFeedItem('📊 AI insights feature temporarily disabled', 'info');
    }

    function toggleAIMode() {
        aiModeEnabled = !aiModeEnabled;
        const toggleBtn = document.getElementById('ai-mode-toggle');
        
        if (aiModeEnabled) {
            toggleBtn.innerHTML = '🟢 AI Mode: ON';
            addActivityFeedItem('🤖 AI lead routing enabled', 'success');
        } else {
            toggleBtn.innerHTML = '🔴 AI Mode: OFF';
            addActivityFeedItem('⚠️ AI lead routing disabled - manual mode active', 'warning');
        }
    }

    // Predictive Analytics Functions
    function initializePredictiveAnalytics() {
        // Initialize with placeholder data
        updatePredictiveMetrics();
        
        // Update every 30 seconds
        setInterval(updatePredictiveMetrics, 30000);
    }

    async function loadPredictiveAnalytics() {
        try {
            addActivityFeedItem('📊 Loading predictive analytics...', 'info');
            
            // Remove loading state
            const loadingInsight = document.querySelector('.insight-item.loading');
            if (loadingInsight) {
                loadingInsight.remove();
            }
            
            // Get analytics insights
            const insights = await window.predictiveAnalytics.getDashboardInsights();
            
            // Update metrics
            updatePredictiveMetrics(insights);
            
            // Update insights
            updateAIInsights(insights);
            
            addActivityFeedItem('✅ Predictive analytics loaded', 'success');
            
        } catch (error) {
            console.error('Failed to load predictive analytics:', error);
            addActivityFeedItem('❌ Failed to load predictive analytics', 'error');
        }
    }

    function updatePredictiveMetrics(insights = null) {
        if (insights) {
            // Update with real data
            const revenue = insights.revenue || {};
            const quality = insights.leadQuality || {};
            const risk = insights.churnRisk || {};
            const performance = insights.performance || {};
            
            document.getElementById('revenue-forecast').textContent = 
                '$' + (revenue.forecast || 85000).toLocaleString();
            document.getElementById('forecast-confidence').textContent = 
                `${Math.round((revenue.confidence || 0.95) * 100)}% confidence`;
                
            document.getElementById('hot-tier-count').textContent = quality.hot?.count || 0;
            document.getElementById('hot-tier-percent').textContent = quality.hot?.percent || '0%';
            
            document.getElementById('warm-tier-count').textContent = quality.warm?.count || 0;
            document.getElementById('warm-tier-percent').textContent = quality.warm?.percent || '0%';
            
            document.getElementById('cold-tier-count').textContent = quality.cold?.count || 0;
            document.getElementById('cold-tier-percent').textContent = quality.cold?.percent || '0%';
            
            document.getElementById('churn-risk').textContent = 
                risk.totalAtRisk || 0;
            document.getElementById('risk-urgency').textContent = 
                `${risk.totalAtRisk || 0} leads at risk`;
                
            const coachingNeeded = performance.individual?.filter(
                agent => agent.priority === 'high' || agent.priority === 'urgent'
            ).length || 0;
            document.getElementById('coaching-agents').textContent = coachingNeeded;
            document.getElementById('coaching-action').textContent = 
                `${coachingNeeded} agents need coaching`;
                
        } else {
            // Update with mock data
            document.getElementById('revenue-forecast').textContent = '$85,000';
            document.getElementById('forecast-confidence').textContent = '95% confidence';
            document.getElementById('hot-tier-count').textContent = '0';
            document.getElementById('hot-tier-percent').textContent = '0%';
            document.getElementById('warm-tier-count').textContent = '0';
            document.getElementById('warm-tier-percent').textContent = '0%';
            document.getElementById('cold-tier-count').textContent = '0';
            document.getElementById('cold-tier-percent').textContent = '0%';
            document.getElementById('churn-risk').textContent = '3';
            document.getElementById('risk-urgency').textContent = '3 leads at risk';
            document.getElementById('coaching-agents').textContent = '2';
            document.getElementById('coaching-action').textContent = '2 agents need coaching';
        }
    }

    function updateAIInsights(insights) {
        const insightsList = document.getElementById('performance-insights-list');
        insightsList.innerHTML = '';
        
        const allInsights = [
            ...insights.revenue?.insights || ['Revenue forecasting active'],
            ...insights.leadQuality?.recommendations?.map(r => r.action) || ['Lead quality analysis complete'],
            ...insights.churnRisk?.insights || ['Churn risk monitoring active']
        ];
        
        allInsights.slice(0, 5).forEach(insight => {
            const insightItem = document.createElement('div');
            insightItem.className = 'insight-item';
            insightItem.innerHTML = `
                <div class="insight-icon">💡</div>
                <div class="insight-text">${insight}</div>
            `;
            insightsList.appendChild(insightItem);
        });
    }

    function openPredictiveDemo() {
        // AI demo removed per user request
        addActivityFeedItem('📊 Predictive demo temporarily disabled', 'info');
    }

    async function generateForecast() {
        addActivityFeedItem('📊 Generating revenue forecast...', 'info');
        
        try {
            const forecast = await window.predictiveAnalytics.forecastRevenue('monthly');
            
            document.getElementById('revenue-forecast').textContent = 
                '$' + forecast.forecast.toLocaleString();
            document.getElementById('forecast-confidence').textContent = 
                `${Math.round(forecast.confidence * 100)}% confidence`;
            
            addActivityFeedItem(
                `✅ Forecast generated: $${forecast.forecast.toLocaleString()} projected`,
                'success'
            );
        } catch (error) {
            addActivityFeedItem('❌ Forecast generation failed', 'error');
        }
    }

    async function analyzeRisk() {
        addActivityFeedItem('⚠️ Analyzing churn risk...', 'info');
        
        try {
            const riskAnalysis = await window.predictiveAnalytics.analyzeChurnRisk();
            
            document.getElementById('churn-risk').textContent = riskAnalysis.totalAtRisk;
            document.getElementById('risk-urgency').textContent = 
                `${riskAnalysis.totalAtRisk} leads at risk`;
            
            addActivityFeedItem(
                `✅ Risk analysis complete: ${riskAnalysis.totalAtRisk} leads need attention`,
                riskAnalysis.totalAtRisk > 5 ? 'warning' : 'success'
            );
        } catch (error) {
            addActivityFeedItem('❌ Risk analysis failed', 'error');
        }
    }

    // EXPANDABLE ACTIVITY FUNCTIONALITY
    function expandActivity(activityElement) {
        // Close all other expanded items
        document.querySelectorAll('.activity-item.expanded').forEach(item => {
            if (item !== activityElement) {
                item.classList.remove('expanded');
            }
        });
        
        // Toggle current item
        activityElement.classList.toggle('expanded');
    }

    // Expose expandActivity globally
    window.expandActivity = expandActivity;

    // Navigation functions for admin dashboard
    function exportLeadData() {
        console.log('📊 Exporting lead data...');
        if (window.apiService) {
            window.apiService.exportLeads().then(data => {
                console.log('Export initiated:', data);
                addActivityFeedItem('📊 Lead export started', 'info');
            }).catch(error => {
                addActivityFeedItem('❌ Export failed', 'error');
            });
        }
    }

    function refreshOverview() {
        console.log('🔄 Refreshing overview...');
        if (window.apiService) {
            window.apiService.getDashboardAnalytics().then(data => {
                console.log('Overview refreshed:', data);
                addActivityFeedItem('🔄 Overview data refreshed', 'success');
            });
        }
    }

    function viewAvailableLeads() {
        console.log('🔍 Viewing available leads...');
        // Could open a modal or navigate to leads view
        addActivityFeedItem('👁️ Viewing available leads', 'info');
    }

    function viewClaimedLeads() {
        console.log('🎯 Viewing claimed leads...');
        addActivityFeedItem('👁️ Viewing claimed leads', 'info');
    }

    function viewAgentPerformance() {
        console.log('🏆 Viewing agent performance...');
        if (window.apiService) {
            window.apiService.getPerformanceMetrics().then(data => {
                console.log('Performance data:', data);
                addActivityFeedItem('📊 Agent performance loaded', 'info');
            });
        }
    }

    function viewAnalyticsDetails() {
        console.log('📈 Opening analytics details...');
        // AI demo removed per user request
        addActivityFeedItem('📈 Analytics feature temporarily disabled', 'info');
    }

    function showAnalyticsDetails() {
        console.log('📈 Opening analytics details...');
        // AI demo removed per user request
        addActivityFeedItem('📈 Analytics feature temporarily disabled', 'info');
    }

    function reassignLead() {
        console.log('🔄 Reassigning lead...');
        // Would show lead reassignment modal
        addActivityFeedItem('🔄 Lead reassignment initiated', 'info');
    }

    function bulkActions() {
        console.log('📦 Bulk actions...');
        // Would show bulk actions modal
        addActivityFeedItem('📦 Bulk actions opened', 'info');
    }

    function leadImport() {
        console.log('📥 Lead import...');
        // Would show import modal
        addActivityFeedItem('📥 Lead import started', 'info');
    }

    function agentDashboard() {
        console.log('👤 Opening agent dashboard...');
        // Navigate to agent dashboard
        window.open('agent-dashboard.html', '_blank');
        addActivityFeedItem('👤 Agent dashboard opened', 'info');
    }

    function generatePublisherPackage(publisherName, email, vendorCode, apiKey) {
        // Generate comprehensive posting instructions and API documentation
        const publisherPackage = generatePublisherDocumentation(publisherName, email, vendorCode, apiKey);
        
        // Create downloadable ZIP file with all documentation
        const zip = new JSZip();
        
        // Add posting instructions
        zip.file("posting-instructions.html", publisherPackage.instructions);
        zip.file("api-documentation.md", publisherPackage.apiDocs);
        zip.file("integration-guide.pdf", publisherPackage.integrationGuide);
        zip.file("sample-code.js", publisherPackage.sampleCode);
        zip.file("publisher-credentials.txt", publisherPackage.credentials);
        
        // Generate and download the ZIP file
        zip.generateAsync({type:"blob"}).then(function(content) {
            const link = document.createElement('a');
            link.href = URL.createObjectURL(content);
            link.download = `${publisherName.replace(/\s+/g, '-')}-publisher-package.zip`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        });
    }

    function generatePublisherDocumentation(publisherName, email, vendorCode, apiKey) {
        const baseUrl = window.APP_CONFIG?.apiEndpoint || 'https://9qtb4my1ij.execute-api.us-east-1.amazonaws.com/prod';
        
        const instructions = `
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Claim Connectors - Publisher Integration Guide</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; line-height: 1.6; }
        .header { background: linear-gradient(135deg, #3B82F6, #8B5CF6); color: white; padding: 30px; border-radius: 10px; text-align: center; margin-bottom: 30px; }
        .section { background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #3B82F6; }
        .code { background: #1e1e1e; color: #f8f8f2; padding: 15px; border-radius: 5px; font-family: 'Courier New', monospace; overflow-x: auto; }
        .warning { background: #fff3cd; border-left: 4px solid #ffc107; padding: 15px; border-radius: 5px; }
        .success { background: #d1e7dd; border-left: 4px solid #198754; padding: 15px; border-radius: 5px; }
        table { width: 100%; border-collapse: collapse; margin: 15px 0; }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
        th { background-color: #3B82F6; color: white; }
    </style>
</head>
<body>
    <div class="header">
        <h1>🚀 Claim Connectors Publisher Integration</h1>
        <p>Welcome ${publisherName}! Your complete integration package</p>
    </div>

    <div class="section">
        <h2>📋 Your Publisher Credentials</h2>
        <table>
            <tr><th>Field</th><th>Value</th></tr>
            <tr><td>Publisher Name</td><td>${publisherName}</td></tr>
            <tr><td>Contact Email</td><td>${email}</td></tr>
            <tr><td>Vendor Code</td><td><strong>${vendorCode}</strong></td></tr>
            <tr><td>API Key</td><td><strong>${apiKey}</strong></td></tr>
            <tr><td>API Endpoint</td><td>${baseUrl}</td></tr>
        </table>
        <div class="warning">
            <strong>⚠️ Important:</strong> Keep your API key secure and never share it publicly. This key identifies your leads and ensures proper attribution.
        </div>
    </div>

    <div class="section">
        <h2>🔗 Lead Posting Instructions</h2>
        <p>To send leads to Claim Connectors, POST to our lead submission endpoint:</p>
        
        <h3>Endpoint:</h3>
        <div class="code">POST ${baseUrl}/leads</div>
        
        <h3>Headers Required:</h3>
        <div class="code">
Content-Type: application/json
X-API-Key: ${apiKey}
X-Vendor-Code: ${vendorCode}
        </div>
        
        <h3>Lead Data Format:</h3>
        <div class="code">
{
  "first_name": "John",
  "last_name": "Smith", 
  "email": "john.smith@email.com",
  "phone_home": "(555) 123-4567",
  "address": "123 Main St",
  "city": "Los Angeles", 
  "state": "CA",
  "zip_code": "90210",
  "date_of_incident": "2024-01-15",
  "incident_type": "auto_accident",
  "description": "Rear-ended at intersection",
  "injury_level": "moderate",
  "medical_treatment": "yes",
  "insurance_company": "State Farm",
  "at_fault": "other_party",
  "source": "${publisherName}",
  "vendor_code": "${vendorCode}"
}
        </div>
    </div>

    <div class="section">
        <h2>✅ Required Fields</h2>
        <ul>
            <li><strong>first_name</strong> - Lead's first name</li>
            <li><strong>last_name</strong> - Lead's last name</li>
            <li><strong>email</strong> - Valid email address</li>
            <li><strong>phone_home</strong> - Primary phone number</li>
            <li><strong>state</strong> - US state (2-letter code)</li>
            <li><strong>incident_type</strong> - Type of legal case</li>
            <li><strong>vendor_code</strong> - Your assigned vendor code: ${vendorCode}</li>
        </ul>
    </div>

    <div class="section">
        <h2>📞 Response Handling</h2>
        <p>Our API will respond with one of these status codes:</p>
        
        <h3>Success Response (200):</h3>
        <div class="code">
{
  "success": true,
  "lead_id": "LEAD_12345",
  "message": "Lead submitted successfully",
  "estimated_value": 5000
}
        </div>
        
        <h3>Error Response (400):</h3>
        <div class="code">
{
  "success": false,
  "error": "Missing required field: email",
  "code": "VALIDATION_ERROR"
}
        </div>
    </div>

    <div class="section">
        <h2>🧪 Testing Your Integration</h2>
        <p>Use this sample cURL command to test:</p>
        <div class="code">
curl -X POST "${baseUrl}/leads" \\
  -H "Content-Type: application/json" \\
  -H "X-API-Key: ${apiKey}" \\
  -H "X-Vendor-Code: ${vendorCode}" \\
  -d '{
    "first_name": "Test",
    "last_name": "Lead",
    "email": "test@example.com",
    "phone_home": "(555) 123-4567",
    "state": "CA",
    "incident_type": "auto_accident",
    "vendor_code": "${vendorCode}"
  }'
        </div>
    </div>

    <div class="success">
        <h3>✅ Integration Complete!</h3>
        <p>Once you've implemented the above, your leads will flow directly into our system and be distributed to qualified attorneys. You'll receive real-time notifications of lead acceptance and can track performance through your publisher dashboard.</p>
    </div>

    <div class="section">
        <h2>📞 Support & Contact</h2>
        <p>If you need assistance with integration:</p>
        <ul>
            <li><strong>Technical Support:</strong> tech@claimconnectors.com</li>
            <li><strong>Publisher Relations:</strong> publishers@claimconnectors.com</li>
            <li><strong>Phone:</strong> (555) CLAIM-01</li>
        </ul>
    </div>
</body>
</html>
        `;

        const apiDocs = `# Claim Connectors API Documentation

## Publisher: ${publisherName}
## Generated: ${new Date().toISOString()}

### Authentication
- **API Key:** ${apiKey}
- **Vendor Code:** ${vendorCode}

### Endpoints

#### Submit Lead
\`\`\`
POST ${baseUrl}/leads
Content-Type: application/json
X-API-Key: ${apiKey}
X-Vendor-Code: ${vendorCode}
\`\`\`

#### Get Lead Status
\`\`\`
GET ${baseUrl}/leads/{lead_id}/status
X-API-Key: ${apiKey}
\`\`\`

#### Publisher Stats
\`\`\`
GET ${baseUrl}/publisher/stats
X-API-Key: ${apiKey}
\`\`\`

### Field Validation Rules
- **email**: Must be valid email format
- **phone_home**: US phone number format
- **state**: Must be valid US state code
- **zip_code**: Must be valid US ZIP code
- **incident_type**: auto_accident, slip_fall, medical_malpractice, workplace_injury

### Rate Limits
- Maximum 100 requests per minute
- Maximum 10,000 leads per day

### Error Codes
- 400: Bad Request (validation error)
- 401: Unauthorized (invalid API key)
- 429: Rate limit exceeded
- 500: Internal server error

### Webhook Notifications (Optional)
Set up webhook URL in publisher dashboard to receive:
- Lead acceptance notifications
- Lead qualification updates
- Payment notifications
`;

        const sampleCode = `
// Claim Connectors Lead Submission - JavaScript Example
// Publisher: ${publisherName}

const CLAIM_CONNECTORS_CONFIG = {
    apiEndpoint: '${baseUrl}',
    apiKey: '${apiKey}',
    vendorCode: '${vendorCode}'
};

async function submitLead(leadData) {
    try {
        const response = await fetch(\`\${CLAIM_CONNECTORS_CONFIG.apiEndpoint}/leads\`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-API-Key': CLAIM_CONNECTORS_CONFIG.apiKey,
                'X-Vendor-Code': CLAIM_CONNECTORS_CONFIG.vendorCode
            },
            body: JSON.stringify({
                ...leadData,
                vendor_code: CLAIM_CONNECTORS_CONFIG.vendorCode,
                source: '${publisherName}'
            })
        });

        const result = await response.json();
        
        if (response.ok) {
            console.log('Lead submitted successfully:', result);
            return { success: true, data: result };
        } else {
            console.error('Lead submission failed:', result);
            return { success: false, error: result };
        }
    } catch (error) {
        console.error('Network error:', error);
        return { success: false, error: error.message };
    }
}

// Example usage:
const sampleLead = {
    first_name: 'John',
    last_name: 'Doe',
    email: 'john.doe@email.com',
    phone_home: '(555) 123-4567',
    address: '123 Main Street',
    city: 'Los Angeles',
    state: 'CA',
    zip_code: '90210',
    date_of_incident: '2024-01-15',
    incident_type: 'auto_accident',
    description: 'Rear-ended at traffic light',
    injury_level: 'moderate',
    medical_treatment: 'yes'
};

submitLead(sampleLead).then(result => {
    if (result.success) {
        console.log('Lead ID:', result.data.lead_id);
    } else {
        console.log('Error:', result.error);
    }
});
`;

        const credentials = `CLAIM CONNECTORS PUBLISHER CREDENTIALS
=====================================

Publisher Name: ${publisherName}
Contact Email: ${email}
Vendor Code: ${vendorCode}
API Key: ${apiKey}
API Endpoint: ${baseUrl}

IMPORTANT SECURITY NOTES:
- Never share your API key publicly
- Use HTTPS for all API requests  
- Store credentials securely
- Contact support immediately if compromised

QUICK START CHECKLIST:
□ Review posting instructions document
□ Test integration with sample lead
□ Set up error handling
□ Implement webhook notifications (optional)
□ Monitor lead submission dashboard

Support Contact:
Email: publishers@claimconnectors.com
Phone: (555) CLAIM-01
`;

        return {
            instructions,
            apiDocs,
            integrationGuide: "PDF content would be generated here",
            sampleCode,
            credentials
        };
    }
    
    document.addEventListener('DOMContentLoaded', function() {
        // Auto-generate vendor codes and API keys function definitions moved above
        
        // Handle collapsible sections
        document.querySelectorAll('.section-toggle').forEach(toggle => {
            toggle.addEventListener('click', function() {
                const sectionName = this.dataset.section;
                const content = document.getElementById(sectionName + '-content');
                const icon = this.querySelector('.toggle-icon');
                
                // Toggle active state
                this.classList.toggle('active');
                content.classList.toggle('expanded');
                
                // Rotate icon
                if (this.classList.contains('active')) {
                    icon.textContent = '▲';
                } else {
                    icon.textContent = '▼';
                }
                
                // Load predictive analytics when section is opened
                if (sectionName === 'predictive-analytics' && this.classList.contains('active')) {
                    loadPredictiveAnalytics();
                }
            });
        });
        
        // Handle modals
        document.querySelectorAll('[data-modal]').forEach(trigger => {
            trigger.addEventListener('click', function() {
                const modalId = this.dataset.modal;
                const modal = document.getElementById(modalId);
                if (modal) {
                    modal.classList.toggle('active');
                }
            });
        });
        
        // Handle modal close buttons
        document.querySelectorAll('.modal-close').forEach(closeBtn => {
            closeBtn.addEventListener('click', function() {
                const modal = this.closest('.modal-overlay');
                if (modal) {
                    modal.classList.remove('active');
                }
            });
        });
        
        // Handle FAB menu (simplified)
        const mainFab = document.getElementById('mainFab');
        if (mainFab) {
            mainFab.addEventListener('click', function() {
                document.querySelector('.fab-container').classList.toggle('active');
            });
        }
        
        // Close modals when clicking outside
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('modal-overlay')) {
                e.target.classList.remove('active');
            }
        });
        
        // Update date and time
        function updateDateTime() {
            const now = new Date();
            const hour = now.getHours();
            let greeting = 'morning';
            
            if (hour >= 12 && hour < 17) greeting = 'afternoon';
            else if (hour >= 17) greeting = 'evening';
            
            const greetingEl = document.getElementById('time-greeting');
            const dateEl = document.getElementById('current-date');
            
            if (greetingEl) greetingEl.textContent = greeting;
            if (dateEl) {
                dateEl.textContent = now.toLocaleDateString('en-US', {
                    weekday: 'long',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
            }
        }
        
        updateDateTime();
        setInterval(updateDateTime, 60000); // Update every minute
        
        // Initialize AI features
        initializeAIFeatures();
        
        // Initialize predictive analytics
        initializePredictiveAnalytics();
        
        // Initialize with some mock data
        setTimeout(() => {
            addActivityFeedItem('System ready', 'success');
        }, 2000);
        
        console.log('🎯 Enhanced admin dashboard initialized with AI features');
    });

    // AI Feature Functions
    function initializeAIFeatures() {
        updateAIMetrics();
        setInterval(updateAIMetrics, 10000); // Update every 10 seconds
        
        // Simulate some AI activity
        setTimeout(() => {
            addAIAssignment({
                leadName: 'Jane Smith',
                agentName: 'Sarah Johnson',
                score: 95,
                time: '2 min ago'
            });
        }, 5000);
    }

    async function updateAIMetrics() {
        try {
            if (window.smartLeadRouter) {
                const queueStatus = await window.smartLeadRouter.getQueueStatus();
                const performanceMetrics = await window.smartLeadRouter.getPerformanceMetrics();
                
                document.getElementById('ai-queue-status').textContent = 
                    queueStatus.size > 0 ? `${queueStatus.size} waiting` : 'All assigned';
                document.getElementById('ai-assignment-time').textContent = 
                    `${performanceMetrics.averageAssignmentTime}s`;
                document.getElementById('ai-assignments').textContent = aiAssignmentCounter;
            }
        } catch (error) {
            console.error('Failed to update AI metrics:', error);
        }
    }

    function testAIAssignment() {
        // Generate a test lead
        const testLead = {
            first_name: 'Test',
            last_name: 'Lead',
            email: 'test@example.com',
            phone_home: '(555) 123-4567',
            state: 'CA',
            zip_code: '90210',
            source: 'website',
            lead_value: 5000,
            notes: 'AI test assignment'
        };

        addActivityFeedItem('🤖 Testing AI assignment system...', 'info');

        // Process through AI
        window.smartLeadRouter.assignLeadIntelligently(testLead)
            .then(assignment => {
                addAIAssignment({
                    leadName: `${testLead.first_name} ${testLead.last_name}`,
                    agentName: assignment.agentName || 'Queued',
                    score: assignment.agentScore?.total || 'N/A',
                    time: 'Just now'
                });
                
                aiAssignmentCounter++;
                updateAIMetrics();
                
                addActivityFeedItem(
                    `✅ AI assigned ${testLead.first_name} ${testLead.last_name} to ${assignment.agentName || 'queue'}`,
                    'success'
                );
            })
            .catch(error => {
                addActivityFeedItem('❌ AI assignment test failed', 'error');
            });
    }

    function addAIAssignment(assignment) {
        const listContainer = document.getElementById('ai-assignment-list');
        
        // Remove empty message
        const emptyMessage = listContainer.querySelector('.ai-assignment-empty');
        if (emptyMessage) {
            emptyMessage.remove();
        }
        
        const assignmentElement = document.createElement('div');
        assignmentElement.className = 'ai-assignment-item';
        assignmentElement.innerHTML = `
            <div class="ai-assignment-info">
                <div class="ai-assignment-lead">${assignment.leadName}</div>
                <div class="ai-assignment-agent">→ ${assignment.agentName}</div>
            </div>
            <div class="ai-assignment-metrics">
                <div class="ai-assignment-score">${assignment.score}/100</div>
                <div class="ai-assignment-time">${assignment.time}</div>
            </div>
        `;
        
        listContainer.insertBefore(assignmentElement, listContainer.firstChild);
        
        // Keep only last 10 assignments
        const assignments = listContainer.querySelectorAll('.ai-assignment-item');
        if (assignments.length > 10) {
            assignments[assignments.length - 1].remove();
        }
    }

    function viewAIInsights() {
        // AI demo removed per user request
        addActivityFeedItem('📊 AI insights feature temporarily disabled', 'info');
    }

    function toggleAIMode() {
        aiModeEnabled = !aiModeEnabled;
        const toggleBtn = document.getElementById('ai-mode-toggle');
        
        if (aiModeEnabled) {
            toggleBtn.innerHTML = '🟢 AI Mode: ON';
            addActivityFeedItem('🤖 AI lead routing enabled', 'success');
        } else {
            toggleBtn.innerHTML = '🔴 AI Mode: OFF';
            addActivityFeedItem('⚠️ AI lead routing disabled - manual mode active', 'warning');
        }
    }

    // Predictive Analytics Functions
    function initializePredictiveAnalytics() {
        // Initialize with placeholder data
        updatePredictiveMetrics();
        
        // Update every 30 seconds
        setInterval(updatePredictiveMetrics, 30000);
    }

    async function loadPredictiveAnalytics() {
        try {
            addActivityFeedItem('📊 Loading predictive analytics...', 'info');
            
            // Remove loading state
            const loadingInsight = document.querySelector('.insight-item.loading');
            if (loadingInsight) {
                loadingInsight.remove();
            }
            
            // Get analytics insights
            const insights = await window.predictiveAnalytics.getDashboardInsights();
            
            // Update metrics
            updatePredictiveMetrics(insights);
            
            // Update insights
            updateAIInsights(insights);
            
            addActivityFeedItem('✅ Predictive analytics loaded', 'success');
            
        } catch (error) {
            console.error('Failed to load predictive analytics:', error);
            addActivityFeedItem('❌ Failed to load predictive analytics', 'error');
        }
    }

    function updatePredictiveMetrics(insights = null) {
        if (insights) {
            // Update with real data
            const revenue = insights.revenue || {};
            const quality = insights.leadQuality || {};
            const risk = insights.churnRisk || {};
            const performance = insights.performance || {};
            
            document.getElementById('revenue-forecast').textContent = 
                '$' + (revenue.forecast || 85000).toLocaleString();
            document.getElementById('forecast-confidence').textContent = 
                `${Math.round((revenue.confidence || 0.95) * 100)}% confidence`;
                
            document.getElementById('hot-tier-count').textContent = quality.hot?.count || 0;
            document.getElementById('hot-tier-percent').textContent = quality.hot?.percent || '0%';
            
            document.getElementById('warm-tier-count').textContent = quality.warm?.count || 0;
            document.getElementById('warm-tier-percent').textContent = quality.warm?.percent || '0%';
            
            document.getElementById('cold-tier-count').textContent = quality.cold?.count || 0;
            document.getElementById('cold-tier-percent').textContent = quality.cold?.percent || '0%';
            
            document.getElementById('churn-risk').textContent = 
                risk.totalAtRisk || 0;
            document.getElementById('risk-urgency').textContent = 
                `${risk.totalAtRisk || 0} leads at risk`;
                
            const coachingNeeded = performance.individual?.filter(
                agent => agent.priority === 'high' || agent.priority === 'urgent'
            ).length || 0;
            document.getElementById('coaching-agents').textContent = coachingNeeded;
            document.getElementById('coaching-action').textContent = 
                `${coachingNeeded} agents need coaching`;
                
        } else {
            // Update with mock data
            document.getElementById('revenue-forecast').textContent = '$85,000';
            document.getElementById('forecast-confidence').textContent = '95% confidence';
            document.getElementById('hot-tier-count').textContent = '0';
            document.getElementById('hot-tier-percent').textContent = '0%';
            document.getElementById('warm-tier-count').textContent = '0';
            document.getElementById('warm-tier-percent').textContent = '0%';
            document.getElementById('cold-tier-count').textContent = '0';
            document.getElementById('cold-tier-percent').textContent = '0%';
            document.getElementById('churn-risk').textContent = '3';
            document.getElementById('risk-urgency').textContent = '3 leads at risk';
            document.getElementById('coaching-agents').textContent = '2';
            document.getElementById('coaching-action').textContent = '2 agents need coaching';
        }
    }

    function updateAIInsights(insights) {
        const insightsList = document.getElementById('performance-insights-list');
        insightsList.innerHTML = '';
        
        const allInsights = [
            ...insights.revenue?.insights || ['Revenue forecasting active'],
            ...insights.leadQuality?.recommendations?.map(r => r.action) || ['Lead quality analysis complete'],
            ...insights.churnRisk?.insights || ['Churn risk monitoring active']
        ];
        
        allInsights.slice(0, 5).forEach(insight => {
            const insightItem = document.createElement('div');
            insightItem.className = 'insight-item';
            insightItem.innerHTML = `
                <div class="insight-icon">💡</div>
                <div class="insight-text">${insight}</div>
            `;
            insightsList.appendChild(insightItem);
        });
    }

    function openPredictiveDemo() {
        // AI demo removed per user request
        addActivityFeedItem('📊 Predictive demo temporarily disabled', 'info');
    }

    async function generateForecast() {
        addActivityFeedItem('📊 Generating revenue forecast...', 'info');
        
        try {
            const forecast = await window.predictiveAnalytics.forecastRevenue('monthly');
            
            document.getElementById('revenue-forecast').textContent = 
                '$' + forecast.forecast.toLocaleString();
            document.getElementById('forecast-confidence').textContent = 
                `${Math.round(forecast.confidence * 100)}% confidence`;
            
            addActivityFeedItem(
                `✅ Forecast generated: $${forecast.forecast.toLocaleString()} projected`,
                'success'
            );
        } catch (error) {
            addActivityFeedItem('❌ Forecast generation failed', 'error');
        }
    }

    async function analyzeRisk() {
        addActivityFeedItem('⚠️ Analyzing churn risk...', 'info');
        
        try {
            const riskAnalysis = await window.predictiveAnalytics.analyzeChurnRisk();
            
            document.getElementById('churn-risk').textContent = riskAnalysis.totalAtRisk;
            document.getElementById('risk-urgency').textContent = 
                `${riskAnalysis.totalAtRisk} leads at risk`;
            
            addActivityFeedItem(
                `✅ Risk analysis complete: ${riskAnalysis.totalAtRisk} leads need attention`,
                riskAnalysis.totalAtRisk > 5 ? 'warning' : 'success'
            );
        } catch (error) {
            addActivityFeedItem('❌ Risk analysis failed', 'error');
        }
    }

    // EXPANDABLE ACTIVITY FUNCTIONALITY
    function expandActivity(activityElement) {
        // Close all other expanded items
        document.querySelectorAll('.activity-item.expanded').forEach(item => {
            if (item !== activityElement) {
                item.classList.remove('expanded');
            }
        });
        
        // Toggle current item
        activityElement.classList.toggle('expanded');
    }

    // Expose expandActivity globally
    window.expandActivity = expandActivity;

    // Navigation functions for admin dashboard
    function exportLeadData() {
        console.log('📊 Exporting lead data...');
        if (window.apiService) {
            window.apiService.exportLeads().then(data => {
                console.log('Export initiated:', data);
                addActivityFeedItem('📊 Lead export started', 'info');
            }).catch(error => {
                addActivityFeedItem('❌ Export failed', 'error');
            });
        }
    }

    function refreshOverview() {
        console.log('🔄 Refreshing overview...');
        if (window.apiService) {
            window.apiService.getDashboardAnalytics().then(data => {
                console.log('Overview refreshed:', data);
                addActivityFeedItem('🔄 Overview data refreshed', 'success');
            });
        }
    }

    function viewAvailableLeads() {
        console.log('🔍 Viewing available leads...');
        // Could open a modal or navigate to leads view
        addActivityFeedItem('👁️ Viewing available leads', 'info');
    }

    function viewClaimedLeads() {
        console.log('🎯 Viewing claimed leads...');
        addActivityFeedItem('👁️ Viewing claimed leads', 'info');
    }

    function viewAgentPerformance() {
        console.log('🏆 Viewing agent performance...');
        if (window.apiService) {
            window.apiService.getPerformanceMetrics().then(data => {
                console.log('Performance data:', data);
                addActivityFeedItem('📊 Agent performance loaded', 'info');
            });
        }
    }

    function viewAnalyticsDetails() {
        console.log('📈 Opening analytics details...');
        // AI demo removed per user request
        addActivityFeedItem('📈 Analytics feature temporarily disabled', 'info');
    }

    function showAnalyticsDetails() {
        console.log('📈 Opening analytics details...');
        // AI demo removed per user request
        addActivityFeedItem('📈 Analytics feature temporarily disabled', 'info');
    }

    function reassignLead() {
        console.log('🔄 Reassigning lead...');
        // Would show lead reassignment modal
        addActivityFeedItem('🔄 Lead reassignment initiated', 'info');
    }

    function bulkActions() {
        console.log('📦 Bulk actions...');
        // Would show bulk actions modal
        addActivityFeedItem('📦 Bulk actions opened', 'info');
    }

    function leadImport() {
        console.log('📥 Lead import...');
        // Would show import modal
        addActivityFeedItem('📥 Lead import started', 'info');
    }

    function agentDashboard() {
        console.log('👤 Opening agent dashboard...');
        // Navigate to agent dashboard
        window.open('agent-dashboard.html', '_blank');
        addActivityFeedItem('👤 Agent dashboard opened', 'info');
    }
    </script>

    <!-- 🔧 ENHANCED MODAL FUNCTIONALITY -->
    <script>
    // Global helper functions
    function generateVendorCode() {
        const prefix = 'PUB';
        const timestamp = Date.now().toString().slice(-6);
        const random = Math.random().toString(36).substr(2, 4).toUpperCase();
        return `${prefix}${timestamp}${random}`;
    }
    
    function generateAPIKey() {
        return 'api_' + Math.random().toString(36).substr(2, 32);
    }

    // Ensure functions are available globally
    window.generateVendorCode = generateVendorCode;
    window.generateAPIKey = generateAPIKey;
    window.openAddAgentModal = openAddAgentModal;
    window.openAddPublisherModal = openAddPublisherModal;
    window.closeModal = closeModal;
    window.handleSendAgentInvite = handleSendAgentInvite;
    window.handleCreatePublisher = handleCreatePublisher;
    
    console.log('✅ All modal functions are now globally accessible');
    </script>

    <!-- 📊 ENHANCED VISUAL DASHBOARD FUNCTIONALITY -->
    <script>
    // CHART MODAL FUNCTIONALITY
    function expandChart(type) {
        const modal = document.getElementById('chart-modal');
        const title = document.getElementById('chart-modal-title');
        const body = document.getElementById('chart-modal-body');
        
        // Set title and content based on chart type
        const chartData = {
            'leads': { title: 'Lead Volume Analysis', content: createLeadChart() },
            'agents': { title: 'Agent Performance Dashboard', content: createAgentChart() },
            'conversion': { title: 'Conversion Analysis', content: createConversionChart() },
            'revenue': { title: 'Revenue Forecast', content: createRevenueChart() },
            'lead-sources': { title: 'Lead Sources Breakdown', content: createLeadSourceChart() },
            'agent-performance': { title: 'Detailed Agent Performance', content: createAgentChart() }
        };
        
        const data = chartData[type] || { title: 'Analytics', content: '<p>Chart loading...</p>' };
        title.textContent = data.title;
        body.innerHTML = data.content;
        
        modal.classList.add('active');
        addActivityFeedItem(`📊 Opened ${data.title}`, 'info');
    }

    function closeChartModal() {
        document.getElementById('chart-modal').classList.remove('active');
    }

    // CHART CREATION FUNCTIONS
    function createLeadChart() {
        return `
            <div class="chart-stats-row">
                <div class="chart-stat">
                    <span class="chart-stat-value">847</span>
                    <span class="chart-stat-label">Total Leads This Month</span>
                </div>
                <div class="chart-stat">
                    <span class="chart-stat-value">+23%</span>
                    <span class="chart-stat-label">Growth Rate</span>
                </div>
            </div>
        `;
    }

    function createAgentChart() {
        return `
            <div class="agent-performance-grid">
                <div class="agent-card">
                    <div class="agent-avatar">SJ</div>
                    <div class="agent-name">Sarah Johnson</div>
                    <div class="agent-metrics">
                        <div class="metric">
                            <span class="metric-value">147</span>
                            <span class="metric-label">Claims</span>
                        </div>
                        <div class="metric">
                            <span class="metric-value">89%</span>
                            <span class="metric-label">Close Rate</span>
                        </div>
                    </div>
                </div>
            </div>
        `;
    }

    function createConversionChart() {
        return `
            <div class="conversion-funnel">
                <div class="funnel-stage" style="width: 100%;">
                    <span class="stage-label">Leads Generated</span>
                    <span class="stage-value">1,247</span>
                </div>
                <div class="funnel-stage" style="width: 65%;">
                    <span class="stage-label">Contacted</span>
                    <span class="stage-value">811</span>
                </div>
            </div>
        `;
    }

    function createRevenueChart() {
        return `
            <div class="revenue-metrics">
                <div class="revenue-card">
                    <span class="revenue-amount">$247,650</span>
                    <span class="revenue-label">This Month</span>
                    <span class="revenue-change positive">+18.5%</span>
                </div>
            </div>
        `;
    }

    function createLeadSourceChart() {
        return `
            <div class="source-breakdown">
                <div class="source-item">
                    <div class="source-color" style="background: #3B82F6;"></div>
                    <span class="source-name">Website</span>
                    <span class="source-percentage">34%</span>
                    <span class="source-count">425 leads</span>
                </div>
                <div class="source-item">
                    <div class="source-color" style="background: #8B5CF6;"></div>
                    <span class="source-name">Referrals</span>
                    <span class="source-percentage">28%</span>
                    <span class="source-count">350 leads</span>
                </div>
            </div>
        `;
    }

    // INITIALIZE VISUAL ELEMENTS
    function initializeVisualDashboard() {
        // Initialize agent performance mini bars
        const container = document.getElementById('agent-performance-mini');
        if (container) {
            const agents = [85, 92, 78, 88, 95, 82];
            container.innerHTML = agents.map(performance => 
                `<div class="agent-bar" style="--height: ${performance}%;"></div>`
            ).join('');
        }

        // Initialize progress indicators
        const weekProgress = document.getElementById('week-progress');
        if (weekProgress) weekProgress.style.setProperty('--progress', '78%');
        
        const todayProgress = document.getElementById('today-progress');
        if (todayProgress) todayProgress.style.setProperty('--progress', '65%');
        
        const teamBar = document.getElementById('team-performance-bar');
        if (teamBar) teamBar.style.setProperty('--progress', '87%');

        // Initialize conversion ring
        const ring = document.getElementById('conversion-ring');
        if (ring) {
            ring.style.setProperty('--progress', 68);
            ring.setAttribute('data-percent', '68%');
        }

        // Start real-time updates
        setTimeout(() => {
            updateRealTimeData();
            setInterval(updateRealTimeData, 15000);
        }, 2000);
        
        console.log('📊 Visual dashboard initialized');
    }

    // REAL-TIME UPDATES
    function updateRealTimeData() {
        const updates = {
            totalLeads: Math.floor(Math.random() * 50) + 847,
            activeAgents: Math.floor(Math.random() * 3) + 8,
            conversionRate: Math.floor(Math.random() * 10) + 65,
            monthlyRevenue: Math.floor(Math.random() * 10000) + 247000
        };
        
        animateValue('total-leads', updates.totalLeads);
        animateValue('active-agents', updates.activeAgents);
        animateValue('conversion-rate', updates.conversionRate, '%');
        animateValue('monthly-revenue', updates.monthlyRevenue, '$', true);
    }

    function animateValue(elementId, endValue, suffix = '', currency = false) {
        const element = document.getElementById(elementId);
        if (!element) return;
        
        const startValue = parseInt(element.textContent.replace(/[^0-9]/g, '')) || 0;
        const steps = 20;
        const stepValue = (endValue - startValue) / steps;
        let currentStep = 0;
        
        const timer = setInterval(() => {
            currentStep++;
            const currentValue = Math.floor(startValue + (stepValue * currentStep));
            
            if (currency) {
                element.textContent = '$' + currentValue.toLocaleString();
            } else {
                element.textContent = currentValue + suffix;
            }
            
            if (currentStep >= steps) {
                clearInterval(timer);
                if (currency) {
                    element.textContent = '$' + endValue.toLocaleString();
                } else {
                    element.textContent = endValue + suffix;
                }
            }
        }, 50);
    }

    // Expose functions globally
    window.expandChart = expandChart;
    window.closeChartModal = closeChartModal;
    
    // Initialize when DOM loads
    document.addEventListener('DOMContentLoaded', function() {
        setTimeout(initializeVisualDashboard, 1000);
    });
    </script>

    <!-- 🎨 CHART MODAL & VISUAL ELEMENTS STYLING -->
    <style>
    /* CHART STATS */
    .chart-stats-row {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
        margin-bottom: 2rem;
    }

    .chart-stat {
        background: var(--bg-secondary);
        border: 1px solid var(--border-subtle);
        border-radius: var(--radius-lg);
        padding: 1.5rem;
        text-align: center;
        transition: all var(--transition-base);
    }

    .chart-stat:hover {
        border-color: var(--accent-purple);
        transform: translateY(-2px);
    }

    .chart-stat-value {
        display: block;
        font-size: 2rem;
        font-weight: 800;
        color: var(--accent-purple);
        margin-bottom: 0.5rem;
    }

    .chart-stat-label {
        font-size: 0.875rem;
        color: var(--text-secondary);
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    /* AGENT PERFORMANCE GRID */
    .agent-performance-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 1.5rem;
        margin-bottom: 2rem;
    }

    .agent-card {
        background: var(--bg-secondary);
        border: 1px solid var(--border-subtle);
        border-radius: var(--radius-lg);
        padding: 1.5rem;
        text-align: center;
        transition: all var(--transition-base);
        position: relative;
        overflow: hidden;
    }

    .agent-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: linear-gradient(90deg, var(--accent-purple), var(--accent-blue));
    }

    .agent-card:hover {
        transform: translateY(-4px);
        border-color: var(--accent-purple);
        box-shadow: 0 15px 35px rgba(139, 92, 246, 0.3);
    }

    .agent-avatar {
        width: 56px;
        height: 56px;
        background: linear-gradient(135deg, var(--accent-purple), var(--accent-blue));
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: 700;
        font-size: 1.25rem;
        margin: 0 auto 1rem;
        box-shadow: 0 8px 20px rgba(139, 92, 246, 0.4);
    }

    .agent-name {
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 1.5rem;
        font-size: 1.1rem;
    }

    .agent-metrics {
        display: flex;
        gap: 2rem;
        justify-content: center;
    }

    .metric {
        text-align: center;
    }

    .metric-value {
        display: block;
        font-size: 1.75rem;
        font-weight: 700;
        color: var(--accent-blue);
        margin-bottom: 0.25rem;
    }

    .metric-label {
        font-size: 0.75rem;
        color: var(--text-muted);
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    /* CONVERSION FUNNEL */
    .conversion-funnel {
        margin-bottom: 2rem;
        padding: 1rem;
    }

    .funnel-stage {
        background: var(--bg-secondary);
        border: 1px solid var(--border-subtle);
        border-radius: var(--radius-md);
        padding: 1.25rem;
        margin-bottom: 0.75rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
        transition: all 0.5s ease;
        position: relative;
        overflow: hidden;
    }

    .funnel-stage::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        bottom: 0;
        background: linear-gradient(90deg, var(--accent-purple), transparent);
        transition: width 1s ease;
    }

    .funnel-stage:nth-child(1)::before { width: 100%; opacity: 0.1; }
    .funnel-stage:nth-child(2)::before { width: 65%; opacity: 0.15; }
    .funnel-stage:nth-child(3)::before { width: 45%; opacity: 0.2; }
    .funnel-stage:nth-child(4)::before { width: 28%; opacity: 0.25; }

    .funnel-stage:hover {
        border-color: var(--accent-purple);
        transform: translateX(8px);
    }

    .stage-label {
        color: var(--text-primary);
        font-weight: 600;
        font-size: 1rem;
        position: relative;
        z-index: 1;
    }

    .stage-value {
        color: var(--accent-purple);
        font-weight: 700;
        font-size: 1.25rem;
        position: relative;
        z-index: 1;
    }

    /* REVENUE METRICS */
    .revenue-metrics {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 1.5rem;
        margin-bottom: 2rem;
    }

    .revenue-card {
        background: var(--bg-secondary);
        border: 1px solid var(--border-subtle);
        border-radius: var(--radius-lg);
        padding: 2rem 1.5rem;
        text-align: center;
        position: relative;
        overflow: hidden;
        transition: all var(--transition-base);
    }

    .revenue-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: var(--success);
    }

    .revenue-card:hover {
        transform: translateY(-4px);
        border-color: var(--success);
        box-shadow: 0 15px 35px rgba(16, 185, 129, 0.3);
    }

    .revenue-amount {
        display: block;
        font-size: 2.25rem;
        font-weight: 800;
        color: var(--success);
        margin-bottom: 0.5rem;
        line-height: 1;
    }

    .revenue-label {
        display: block;
        font-size: 0.875rem;
        color: var(--text-secondary);
        margin-bottom: 0.75rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .revenue-change {
        font-size: 0.875rem;
        font-weight: 600;
        padding: 0.25rem 0.75rem;
        border-radius: var(--radius-md);
        background: rgba(16, 185, 129, 0.1);
    }

    .revenue-change.positive {
        color: var(--success);
    }

    /* LEAD SOURCE BREAKDOWN */
    .source-breakdown {
        margin-bottom: 2rem;
    }

    .source-item {
        display: flex;
        align-items: center;
        gap: 1rem;
        padding: 1.25rem;
        background: var(--bg-secondary);
        border: 1px solid var(--border-subtle);
        border-radius: var(--radius-md);
        margin-bottom: 0.75rem;
        transition: all var(--transition-base);
    }

    .source-item:hover {
        border-color: var(--accent-purple);
        transform: translateX(4px);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
    }

    .source-color {
        width: 20px;
        height: 20px;
        border-radius: 50%;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        flex-shrink: 0;
    }

    .source-name {
        flex: 1;
        color: var(--text-primary);
        font-weight: 600;
        font-size: 1rem;
    }

    .source-percentage {
        color: var(--accent-purple);
        font-weight: 700;
        font-size: 1.25rem;
        margin-right: 1rem;
        min-width: 50px;
        text-align: right;
    }

    .source-count {
        color: var(--text-muted);
        font-size: 0.875rem;
        min-width: 80px;
        text-align: right;
    }

    /* RESPONSIVE CHART ELEMENTS */
    @media (max-width: 768px) {
        .chart-stats-row,
        .agent-performance-grid,
        .revenue-metrics {
            grid-template-columns: 1fr;
        }
        
        .agent-metrics {
            gap: 1rem;
        }
        
        .metric-value {
            font-size: 1.5rem;
        }
        
        .source-item {
            padding: 1rem;
            gap: 0.75rem;
        }
        
        .source-name {
            font-size: 0.9rem;
        }
        
        .funnel-stage {
            padding: 1rem;
            flex-direction: column;
            gap: 0.5rem;
            text-align: center;
        }
        
        .revenue-amount {
            font-size: 1.75rem;
        }
    }

    /* ENHANCED ANIMATIONS */
    @keyframes slideIn {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .chart-stat,
    .agent-card,
    .revenue-card,
    .source-item,
    .funnel-stage {
        animation: slideIn 0.6s ease-out;
    }

    .agent-card:nth-child(2) { animation-delay: 0.1s; }
    .agent-card:nth-child(3) { animation-delay: 0.2s; }
    .source-item:nth-child(2) { animation-delay: 0.1s; }
    .source-item:nth-child(3) { animation-delay: 0.2s; }
    .source-item:nth-child(4) { animation-delay: 0.3s; }

    /* ENHANCED REVENUE FORECAST STYLING */
    .revenue-forecast-container {
        display: flex;
        flex-direction: column;
        gap: 1.5rem;
    }

    .forecast-main {
        display: flex;
        flex-direction: column;
        gap: 1.25rem;
    }

    .forecast-amount {
        text-align: center;
        padding: 1rem;
        background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(16, 185, 129, 0.05));
        border-radius: var(--radius-lg);
        border: 1px solid rgba(16, 185, 129, 0.2);
    }

    .forecast-value {
        display: block;
        font-size: 2.5rem;
        font-weight: 800;
        color: var(--success);
        line-height: 1;
        margin-bottom: 0.5rem;
        text-shadow: 0 2px 4px rgba(16, 185, 129, 0.3);
    }

    .forecast-period {
        font-size: 0.875rem;
        color: var(--text-secondary);
        text-transform: uppercase;
        letter-spacing: 0.5px;
        font-weight: 600;
    }

    .forecast-confidence {
        padding: 1rem;
        background: var(--bg-secondary);
        border-radius: var(--radius-md);
        border-left: 4px solid var(--accent-blue);
    }

    .confidence-label {
        font-size: 0.875rem;
        color: var(--text-secondary);
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 0.75rem;
    }

    .confidence-bar {
        position: relative;
        background: rgba(59, 130, 246, 0.1);
        height: 24px;
        border-radius: 12px;
        overflow: hidden;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .confidence-fill {
        position: absolute;
        left: 0;
        top: 0;
        height: 100%;
        background: linear-gradient(90deg, var(--accent-blue), var(--accent-purple));
        border-radius: 12px;
        transition: width 1s ease-out;
        animation: confidence-flow 3s ease-in-out infinite;
    }

    @keyframes confidence-flow {
        0%, 100% { box-shadow: 0 0 0 rgba(59, 130, 246, 0); }
        50% { box-shadow: 0 0 12px rgba(59, 130, 246, 0.6); }
    }

    .confidence-value {
        position: relative;
        z-index: 1;
        color: white;
        font-weight: 700;
        font-size: 0.875rem;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
    }

    .forecast-insights {
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
    }

    .insight-item {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        padding: 0.75rem;
        background: var(--bg-secondary);
        border-radius: var(--radius-md);
        border-left: 3px solid var(--success);
        transition: all var(--transition-base);
    }

    .insight-item:hover {
        background: var(--bg-accent);
        transform: translateX(4px);
        border-left-color: var(--accent-purple);
    }

    .insight-icon {
        font-size: 1.125rem;
        flex-shrink: 0;
    }

    .insight-text {
        color: var(--text-primary);
        font-size: 0.875rem;
        font-weight: 500;
    }

    /* RESPONSIVE ENHANCEMENTS FOR REVENUE FORECAST */
    @media (max-width: 768px) {
        .forecast-value {
            font-size: 2rem;
        }
        
        .revenue-forecast-container {
            gap: 1rem;
        }
        
        .forecast-main {
            gap: 1rem;
        }
        
        .forecast-amount {
            padding: 0.75rem;
        }
        
        .forecast-confidence {
            padding: 0.75rem;
        }
        
        .confidence-bar {
            height: 20px;
        }
    }

    /* FLOATING ACTION BUTTON (FAB) STYLES */
    .fab-container {
        position: fixed;
        bottom: 2rem;
        right: 2rem;
        z-index: 1000;
        display: flex;
        flex-direction: column;
        align-items: flex-end;
        gap: 1rem;
    }

    .fab {
        width: 56px;
        height: 56px;
        border-radius: 50%;
        background: linear-gradient(135deg, var(--accent-purple), var(--accent-blue));
        border: none;
        color: white;
        font-size: 1.5rem;
        cursor: pointer;
        box-shadow: 0 8px 20px rgba(139, 92, 246, 0.4);
        transition: all var(--transition-base);
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
        z-index: 1001;
    }

    .fab:hover {
        transform: scale(1.1) rotate(90deg);
        box-shadow: 0 12px 30px rgba(139, 92, 246, 0.6);
    }

    .fab-icon {
        transition: transform var(--transition-base);
    }

    .fab-container.active .fab {
        transform: rotate(45deg);
        background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
    }

    .fab-menu {
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
        opacity: 0;
        visibility: hidden;
        transform: translateY(20px);
        transition: all var(--transition-base);
        max-height: 0;
        overflow: hidden;
    }

    .fab-container.active .fab-menu {
        opacity: 1;
        visibility: visible;
        transform: translateY(0);
        max-height: 300px;
    }

    .fab-action {
        background: var(--bg-glass);
        backdrop-filter: blur(20px);
        color: var(--text-primary);
        border: 1px solid var(--border-subtle);
        padding: 0.75rem 1rem;
        border-radius: var(--radius-lg);
        cursor: pointer;
        transition: all var(--transition-base);
        display: flex;
        align-items: center;
        gap: 0.75rem;
        font-size: 0.875rem;
        font-weight: 500;
        white-space: nowrap;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        min-width: 140px;
        justify-content: flex-start;
    }

    .fab-action:hover {
        background: linear-gradient(135deg, var(--accent-purple), var(--accent-blue));
        color: white;
        border-color: var(--accent-purple);
        transform: translateX(-8px) scale(1.05);
        box-shadow: 0 8px 20px rgba(139, 92, 246, 0.4);
    }

    .fab-action span:first-child {
        font-size: 1rem;
    }

    /* RESPONSIVE FAB */
    @media (max-width: 768px) {
        .fab-container {
            bottom: 1rem;
            right: 1rem;
        }
        
        .fab {
            width: 48px;
            height: 48px;
            font-size: 1.25rem;
        }
        
        .fab-action {
            padding: 0.625rem 0.875rem;
            font-size: 0.8rem;
            min-width: 120px;
        }
    }

    /* ACTION BUTTONS ENHANCED */
    .action-btn {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 1rem;
        padding: 1.5rem;
        background: linear-gradient(135deg, var(--bg-secondary), var(--bg-accent));
        border: 1px solid var(--border-subtle);
        border-radius: var(--radius-lg);
        cursor: pointer;
        transition: all var(--transition-base);
        text-decoration: none;
        color: var(--text-primary);
        position: relative;
        overflow: hidden;
    }

    .action-btn::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: linear-gradient(90deg, var(--accent-purple), var(--accent-blue));
    }

    .action-btn:hover {
        background: linear-gradient(135deg, var(--bg-accent), var(--bg-secondary));
        border-color: var(--accent-blue);
        transform: translateY(-2px);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
    }

    .btn-icon {
        font-size: 2rem;
        color: var(--accent-purple);
        margin-bottom: 0.5rem;
        transition: all var(--transition-base);
    }

    .action-btn:hover .btn-icon {
        color: var(--accent-blue);
        transform: scale(1.1);
    }

    .btn-text {
        font-weight: 600;
        text-align: center;
    }

    /* FILTER BUTTONS ENHANCED */
    .filter-btn {
        padding: 0.5rem 1rem;
        background: linear-gradient(135deg, var(--bg-secondary), var(--bg-accent));
        border: 1px solid var(--border-subtle);
        border-radius: var(--radius-md);
        color: var(--text-secondary);
        font-size: 0.875rem;
        font-weight: 500;
        cursor: pointer;
        transition: all var(--transition-base);
    }

    .filter-btn.active,
    .filter-btn:hover {
        background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
        border-color: var(--accent-blue);
        color: white;
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
    }

    /* CHART MODAL STYLES */
    .chart-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        backdrop-filter: blur(10px);
        z-index: 10000;
        align-items: center;
        justify-content: center;
    }

    .chart-modal.active {
        display: flex !important;
    }

    .chart-modal-content {
        background: var(--bg-glass);
        backdrop-filter: blur(20px);
        border: 1px solid var(--border-subtle);
        border-radius: var(--radius-xl);
        box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
        max-width: 90vw;
        max-height: 90vh;
        width: 800px;
        overflow-y: auto;
    }

    .chart-modal-header {
        padding: 2rem 2rem 1rem;
        border-bottom: 1px solid var(--border-subtle);
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .chart-modal-header h3 {
        color: var(--text-primary);
        font-size: 1.5rem;
        font-weight: 700;
        margin: 0;
    }

    .chart-modal-close {
        background: none;
        border: none;
        color: var(--text-muted);
        font-size: 2rem;
        cursor: pointer;
        padding: 0;
        line-height: 1;
        transition: color var(--transition-base);
    }

    .chart-modal-close:hover {
        color: var(--text-primary);
    }

    .chart-modal-body {
        padding: 2rem;
    }

    /* RESPONSIVE CHART MODAL */
    @media (max-width: 768px) {
        .chart-modal-content {
            width: 95%;
            margin: 1rem;
            max-height: 85vh;
        }
        
        .chart-modal-header,
        .chart-modal-body {
            padding: 1.5rem;
        }
    }

    /* CORE LAYOUT STYLES */
    .admin-section {
        background: var(--bg-glass);
        backdrop-filter: blur(20px);
        border: 1px solid var(--border-subtle);
        border-radius: var(--radius-lg);
        margin-bottom: 2rem;
        overflow: hidden;
    }

    .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1.5rem 2rem;
        border-bottom: 1px solid var(--border-subtle);
        background: rgba(139, 92, 246, 0.05);
    }

    .section-title {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        color: var(--text-primary);
        font-size: 1.25rem;
        font-weight: 700;
    }

    .section-icon {
        font-size: 1.5rem;
        color: var(--accent-purple);
    }

    .section-actions {
        display: flex;
        gap: 0.75rem;
        align-items: center;
    }

    .overview-grid,
    .analytics-grid,
    .ai-insights-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 1.5rem;
        padding: 2rem;
    }

    .overview-card,
    .analytics-card,
    .ai-insight-card {
        background: var(--bg-secondary);
        border: 1px solid var(--border-subtle);
        border-radius: var(--radius-lg);
        padding: 1.5rem;
        transition: all var(--transition-base);
    }

    .overview-card:hover,
    .analytics-card:hover,
    .ai-insight-card:hover {
        border-color: var(--accent-purple);
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(139, 92, 246, 0.2);
    }

    .admin-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 2rem;
        margin-bottom: 2rem;
    }

    .management-actions {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
        padding: 2rem;
    }

    .quick-filters {
        padding: 1.5rem 2rem 2rem;
    }

    .filter-buttons {
        display: flex;
        gap: 0.75rem;
        flex-wrap: wrap;
        margin-top: 1rem;
    }

    .real-time-indicator {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        margin-left: 0.75rem;
    }

    .pulse-dot {
        width: 8px;
        height: 8px;
        background: var(--success);
        border-radius: 50%;
        animation: pulse 2s infinite;
    }

    @keyframes pulse {
        0%, 100% { opacity: 1; transform: scale(1); }
        50% { opacity: 0.5; transform: scale(1.1); }
    }

    .real-time-text {
        font-size: 0.75rem;
        color: var(--success);
        font-weight: 500;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .ai-badge {
        background: linear-gradient(135deg, var(--accent-purple), var(--accent-blue));
        color: white;
        padding: 0.25rem 0.75rem;
        border-radius: 1rem;
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-left: 0.5rem;
    }

    /* FORM STYLES */
    .form-group {
        margin-bottom: 1.5rem;
    }

    .form-group label {
        display: block;
        margin-bottom: 0.5rem;
        color: var(--text-primary);
        font-weight: 500;
    }

    .form-input {
        width: 100%;
        padding: 0.75rem;
        background: var(--bg-secondary);
        border: 1px solid var(--border-subtle);
        border-radius: var(--radius-md);
        color: var(--text-primary);
        font-size: 0.875rem;
        transition: all var(--transition-base);
    }

    .form-input:focus {
        outline: none;
        border-color: var(--accent-purple);
        box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1);
    }

    /* RESPONSIVE LAYOUTS */
    @media (max-width: 1024px) {
        .admin-grid {
            grid-template-columns: 1fr;
        }
        
        .overview-grid,
        .analytics-grid {
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        }
    }

    @media (max-width: 768px) {
        .section-header {
            flex-direction: column;
            gap: 1rem;
            align-items: flex-start;
        }
        
        .section-actions {
            width: 100%;
            justify-content: flex-start;
        }
        
        .overview-grid,
        .analytics-grid,
        .ai-insights-grid {
            grid-template-columns: 1fr;
            padding: 1.5rem;
        }
        
        .management-actions {
            grid-template-columns: 1fr;
            padding: 1.5rem;
        }
        
        .filter-buttons {
            justify-content: center;
        }
    }
    </style>
</body>
</html>
