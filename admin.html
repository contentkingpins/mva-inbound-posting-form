<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Claim Connectors</title>
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    
    <!-- Preconnect to CDNs -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Icons -->
    <link rel="stylesheet" href="https://unpkg.com/lucide@latest/dist/lucide.css">
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    
    <!-- CountUp.js for number animations -->
    <script src="https://unpkg.com/countup.js@2.8.0/dist/countUp.umd.js"></script>
    
    <!-- Critical functions -->
    <script src="critical-functions.js"></script>
    
    <!-- JSZip for creating downloadable publisher packages -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    
    <!-- jsPDF for generating PDF instructions -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Build-Time Injected Configuration -->
    <script>
    window.APP_CONFIG = {
        "userPoolId": "us-east-1_lhc964tLD",
        "clientId": "5t6mane4fnvineksoqb4ta0iu1",
        "apiEndpoint": "https://9qtb4my1ij.execute-api.us-east-1.amazonaws.com/prod",
        "apiUrl": "https://9qtb4my1ij.execute-api.us-east-1.amazonaws.com/prod",
        "apiKey": "",
        "buildTime": "2025-05-29T01:13:52.266Z",
        "buildEnv": "production"
    };
    window.preloadedConfig = window.APP_CONFIG;
    console.log('🔧 Configuration injected at build time');
    </script>
    
    <!-- Admin Dashboard Styles -->
    <style>
    /* Dark Theme Variables */
    :root {
        --bg-primary: #0F0F23;
        --bg-secondary: #1A1A2E;
        --bg-accent: #16213E;
        --bg-glass: rgba(26, 26, 46, 0.95);
        --text-primary: #FFFFFF;
        --text-secondary: #CBD5E1;
        --text-muted: #9CA3AF;
        --accent-blue: #3B82F6;
        --accent-purple: #8B5CF6;
        --success: #10B981;
        --warning: #F59E0B;
        --error: #EF4444;
        --border-subtle: rgba(139, 92, 246, 0.2);
        --border-accent: rgba(59, 130, 246, 0.3);
        --font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        --space-4: 1rem;
        --space-6: 1.5rem;
        --radius-md: 0.5rem;
        --radius-lg: 0.75rem;
        --radius-xl: 1rem;
        --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.5);
        --transition-base: 0.3s ease;
    }
    
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
        font-family: var(--font-family);
        background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
        color: var(--text-primary);
        min-height: 100vh;
        line-height: 1.6;
    }
    
    /* Header Styles */
    .admin-header {
        background: var(--bg-glass);
        backdrop-filter: blur(20px);
        border-bottom: 1px solid var(--border-subtle);
        padding: var(--space-4) var(--space-6);
        position: sticky;
        top: 0;
        z-index: 100;
    }
    
    .header-content {
        display: flex;
        justify-content: space-between;
        align-items: center;
        max-width: 1400px;
        margin: 0 auto;
    }
    
    .header-title {
        color: var(--accent-purple);
        font-size: 1.5rem;
        font-weight: 700;
        display: flex;
        align-items: center;
        gap: 0.75rem;
    }
    
    .header-greeting {
        color: var(--text-secondary);
        font-size: 0.875rem;
        margin-top: 0.25rem;
    }
    
    .ai-badge {
        background: linear-gradient(135deg, var(--accent-purple), var(--accent-blue));
        color: white;
        padding: 0.25rem 0.75rem;
        border-radius: 1rem;
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-left: 0.5rem;
    }
    
    .header-right {
        display: flex;
        align-items: center;
        gap: 1rem;
        flex-wrap: wrap;
    }
    
    .header-date {
        color: var(--text-secondary);
        font-size: 0.875rem;
        font-weight: 500;
    }
    
    /* Main Content */
    .admin-main {
        max-width: 1400px;
        margin: 0 auto;
        padding: var(--space-6);
        min-height: calc(100vh - 80px);
    }
    
    .admin-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 2rem;
        margin-bottom: 2rem;
    }
    
    /* Stats Grid */
    .quick-stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 1.25rem;
        margin-bottom: 2rem;
    }
    
    .stat-card {
        background: var(--bg-glass);
        backdrop-filter: blur(20px);
        border: 1px solid var(--border-subtle);
        border-radius: var(--radius-lg);
        padding: 1.25rem;
        transition: all var(--transition-base);
        position: relative;
        overflow: hidden;
    }

    .stat-card:hover {
        border-color: var(--accent-purple);
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(139, 92, 246, 0.2);
    }

    .stat-icon {
        font-size: 2rem;
        margin-bottom: 1rem;
        color: var(--accent-purple);
    }

    .stat-content {
        flex: 1;
    }

    .stat-value {
        font-size: 2.5rem;
        font-weight: 800;
        color: var(--text-primary);
        line-height: 1;
        margin-bottom: 0.5rem;
    }

    .stat-label {
        font-size: 0.875rem;
        color: var(--text-secondary);
        text-transform: uppercase;
        letter-spacing: 0.5px;
        font-weight: 600;
        margin-bottom: 0.75rem;
    }

    .stat-change {
        font-size: 0.75rem;
        font-weight: 500;
        padding: 0.25rem 0.5rem;
        border-radius: var(--radius-md);
        background: rgba(16, 185, 129, 0.1);
        color: var(--success);
        display: inline-block;
    }
    
    /* Sections */
    .admin-section {
        background: var(--bg-glass);
        backdrop-filter: blur(20px);
        border: 1px solid var(--border-subtle);
        border-radius: var(--radius-lg);
        padding: 2rem;
        margin-bottom: 2rem;
        transition: all var(--transition-base);
    }

    .admin-section:hover {
        border-color: var(--accent-purple);
        box-shadow: 0 8px 20px rgba(139, 92, 246, 0.1);
    }

    .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2rem;
        flex-wrap: wrap;
        gap: 1rem;
    }

    .section-title {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        flex: 1;
    }

    .section-title h2 {
        color: var(--text-primary);
        font-size: 1.5rem;
        font-weight: 700;
        margin: 0;
    }

    .section-icon {
        font-size: 1.5rem;
        color: var(--accent-purple);
    }

    .section-actions {
        display: flex;
        gap: 0.75rem;
        flex-wrap: wrap;
    }
    
    /* Buttons */
    .btn {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.75rem 1rem;
        border: none;
        border-radius: 0.5rem;
        font-size: 0.875rem;
        font-weight: 500;
        cursor: pointer;
        transition: all var(--transition-base);
        text-decoration: none;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .btn:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }

    .btn-primary {
        background: linear-gradient(135deg, var(--accent-blue), #2563EB);
        color: white;
        border: 1px solid var(--accent-blue);
    }

    .btn-secondary {
        background: linear-gradient(135deg, var(--bg-accent), var(--bg-secondary));
        color: var(--text-primary);
        border: 1px solid var(--border-accent);
    }

    .btn-success {
        background: linear-gradient(135deg, var(--success), #059669);
        color: white;
        border: 1px solid var(--success);
    }

    .btn-info {
        background: linear-gradient(135deg, #3B82F6, #2563EB);
        color: white;
        border: 1px solid #3B82F6;
    }

    .btn-warning {
        background: linear-gradient(135deg, var(--warning), #D97706);
        color: white;
        border: 1px solid var(--warning);
    }

    .btn-danger {
        background: linear-gradient(135deg, var(--error), #DC2626);
        color: white;
        border: 1px solid var(--error);
    }

    .btn-sm {
        padding: 0.5rem 1rem;
        font-size: 0.8rem;
        font-weight: 600;
        white-space: nowrap;
    }
    
    /* Activity Feed */
    .activity-feed {
        max-height: 400px;
        overflow-y: auto;
        padding-right: 0.5rem;
    }

    .activity-item {
        display: flex;
        align-items: flex-start;
        gap: 1rem;
        padding: 1rem;
        margin-bottom: 1rem;
        background: var(--bg-secondary);
        border-radius: var(--radius-md);
        border-left: 3px solid var(--accent-purple);
        transition: all var(--transition-base);
        cursor: pointer;
    }

    .activity-item:hover {
        background: var(--bg-accent);
        transform: translateX(4px);
    }
    
    /* Management Actions */
    .management-actions {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
        margin-bottom: 2rem;
    }

    .action-btn {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 0.5rem;
        padding: 1.5rem;
        background: var(--bg-secondary);
        border: 2px solid var(--border-subtle);
        border-radius: var(--radius-lg);
        color: var(--text-primary);
        text-decoration: none;
        transition: all var(--transition-base);
        cursor: pointer;
    }

    .action-btn:hover {
        border-color: var(--accent-blue);
        background: var(--bg-accent);
        transform: translateY(-2px);
    }

    .btn-icon {
        font-size: 2rem;
        color: var(--accent-purple);
    }

    .btn-text {
        font-weight: 600;
        text-align: center;
    }
    
    /* Publisher Management Styles */
    .publisher-management { margin-top: 2rem; }
    .publisher-stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem; }
    .publisher-filters { display: flex; gap: 1rem; margin-bottom: 2rem; flex-wrap: wrap; }
    .filter-group { flex: 1; min-width: 200px; }
    .table-container { background: var(--bg-secondary); border-radius: var(--radius-lg); overflow: hidden; border: 1px solid var(--border-subtle); }
    .admin-table { width: 100%; border-collapse: collapse; }
    .admin-table th { background: var(--bg-accent); color: var(--text-primary); padding: 1rem; text-align: left; font-weight: 600; border-bottom: 1px solid var(--border-subtle); }
    .admin-table td { padding: 1rem; border-bottom: 1px solid var(--border-subtle); color: var(--text-primary); }
    .admin-table tr:hover { background: var(--bg-accent); }
    .publisher-info { display: flex; flex-direction: column; gap: 0.25rem; }
    .publisher-name { font-weight: 600; color: var(--text-primary); }
    .publisher-email { font-size: 0.875rem; color: var(--text-secondary); }
    .status-badge { padding: 0.25rem 0.75rem; border-radius: 1rem; font-size: 0.75rem; font-weight: 600; }
    .status-badge.active { background: rgba(16, 185, 129, 0.2); color: var(--success); }
    .status-badge.inactive { background: rgba(239, 68, 68, 0.2); color: var(--error); }
    .status-badge.pending { background: rgba(245, 158, 11, 0.2); color: var(--warning); }
    .status-badge.suspended { background: rgba(139, 92, 246, 0.2); color: var(--accent-purple); }
    .vendor-code { font-family: 'Courier New', monospace; background: var(--bg-accent); padding: 0.25rem 0.5rem; border-radius: 0.25rem; font-size: 0.875rem; }
    .api-key-display { font-family: 'Courier New', monospace; background: var(--bg-accent); padding: 0.25rem 0.5rem; border-radius: 0.25rem; font-size: 0.875rem; max-width: 120px; overflow: hidden; text-overflow: ellipsis; }
    .api-key-display.no-key { color: var(--text-muted); background: transparent; }
    .action-buttons { display: flex; gap: 0.5rem; flex-wrap: wrap; }
    .action-btn-sm { padding: 0.25rem 0.5rem; border: none; border-radius: 0.25rem; font-size: 0.75rem; cursor: pointer; transition: all 0.2s ease; white-space: nowrap; }
    .action-btn-sm.view { background: var(--accent-blue); color: white; }
    .action-btn-sm.edit { background: var(--warning); color: white; }
    .action-btn-sm.pdf { background: var(--success); color: white; }
    .action-btn-sm.api { background: var(--accent-purple); color: white; }
    .action-btn-sm.toggle { background: var(--bg-accent); color: var(--text-primary); border: 1px solid var(--border-subtle); }
    .action-btn-sm.delete { background: var(--error); color: white; }
    .bulk-actions-bar { background: var(--bg-glass); backdrop-filter: blur(20px); border: 1px solid var(--border-subtle); border-radius: var(--radius-lg); padding: 1rem; margin-top: 1rem; display: flex; justify-content: space-between; align-items: center; }
    .bulk-info { color: var(--text-primary); font-weight: 600; }
    .bulk-buttons { display: flex; gap: 0.5rem; }
    .publisher-count { background: var(--accent-purple); color: white; padding: 0.25rem 0.75rem; border-radius: 1rem; font-size: 0.75rem; font-weight: 600; }
    
    /* Form Styles */
    .form-group {
        margin-bottom: 1.5rem;
    }

    .form-group label {
        display: block;
        color: var(--text-primary);
        font-size: 0.875rem;
        font-weight: 600;
        margin-bottom: 0.5rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .form-input {
        width: 100%;
        padding: 0.75rem 1rem;
        background: var(--bg-secondary);
        border: 2px solid var(--border-subtle);
        border-radius: var(--radius-md);
        color: var(--text-primary);
        font-size: 0.875rem;
        font-family: var(--font-family);
        transition: all var(--transition-base);
    }

    .form-input:focus {
        outline: none;
        border-color: var(--accent-blue);
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        background: var(--bg-accent);
    }

    .form-input::placeholder {
        color: var(--text-muted);
    }

    .form-input:disabled,
    .form-input[readonly] {
        background: var(--bg-accent);
        color: var(--text-muted);
        cursor: not-allowed;
    }

    select.form-input {
        background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23CBD5E1' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6,9 12,15 18,9'%3e%3c/polyline%3e%3c/svg%3e");
        background-repeat: no-repeat;
        background-position: right 0.75rem center;
        background-size: 1rem;
        padding-right: 2.5rem;
        appearance: none;
        cursor: pointer;
    }
    
    /* Modal Styles */
    .modal-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        backdrop-filter: blur(10px);
        z-index: 10000;
        align-items: center;
        justify-content: center;
    }

    .modal-overlay.active {
        display: flex !important;
    }

    .glass-modal {
        background: var(--bg-glass);
        backdrop-filter: blur(20px);
        border: 1px solid var(--border-subtle);
        border-radius: var(--radius-xl);
        box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
        max-width: 500px;
        width: 90%;
        max-height: 90vh;
        overflow-y: auto;
    }

    .modal-header {
        padding: 2rem 2rem 1rem;
        border-bottom: 1px solid var(--border-subtle);
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .modal-title {
        color: var(--text-primary);
        font-size: 1.5rem;
        font-weight: 700;
        margin: 0;
    }

    .modal-close {
        background: none;
        border: none;
        color: var(--text-muted);
        font-size: 2rem;
        cursor: pointer;
        padding: 0;
        line-height: 1;
        transition: color var(--transition-base);
    }

    .modal-close:hover {
        color: var(--text-primary);
    }

    .modal-body {
        padding: 2rem;
    }

    .modal-footer {
        padding: 1rem 2rem 2rem;
        display: flex;
        gap: 1rem;
        justify-content: flex-end;
    }
    
    /* Responsive Design */
    @media (max-width: 768px) {
        .admin-grid {
            grid-template-columns: 1fr;
        }
        
        .header-content {
            flex-direction: column;
            gap: 1rem;
        }
        
        .header-right {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            justify-content: center;
        }
        
        .section-header {
            flex-direction: column;
            align-items: stretch;
        }
        
        .glass-modal {
            width: 95%;
            margin: 1rem;
        }
        
        .modal-header,
        .modal-body,
        .modal-footer {
            padding: 1.5rem;
        }
        
        .modal-footer {
            flex-direction: column;
        }
        
        .modal-footer .btn {
            width: 100%;
        }
    }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="admin-header">
        <div class="header-content">
            <div class="header-left">
                <h1 class="header-title">
                    <span class="header-icon">⚡</span>
                    Claim Connectors Admin
                </h1>
                <div class="header-greeting">
                    Good <span id="time-greeting">morning</span>, <span id="admin-name">Admin</span> 
                    <span class="ai-badge">⚡ Powered by Angel Dust OS</span>
                </div>
            </div>
            <div class="header-right">
                <div class="header-date" id="current-date"></div>
                <button class="btn btn-success btn-sm" onclick="openAddAgentModal()">
                    👤 Add Agent
                </button>
                <button class="btn btn-info btn-sm" onclick="openAddPublisherModal()">
                    🏢 Add Publisher
                </button>
                <button class="btn btn-secondary btn-sm" id="refresh-all">🔄 Refresh</button>
                <button class="btn btn-warning btn-sm" onclick="handleLogout()">
                    🚪 Logout
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="admin-main">
        <!-- Quick Stats Grid -->
        <div class="quick-stats-grid">
            <div class="stat-card leads">
                <div class="stat-icon">📋</div>
                <div class="stat-content">
                    <div class="stat-value" id="total-leads">0</div>
                    <div class="stat-label">Total Leads</div>
                    <div class="stat-change positive" id="leads-change">+12% this week</div>
                </div>
            </div>
            
            <div class="stat-card agents">
                <div class="stat-icon">👥</div>
                <div class="stat-content">
                    <div class="stat-value" id="active-agents">0</div>
                    <div class="stat-label">Active Agents</div>
                    <div class="stat-change positive" id="agents-change">3 online now</div>
                </div>
            </div>
            
            <div class="stat-card conversion">
                <div class="stat-icon">🎯</div>
                <div class="stat-content">
                    <div class="stat-value" id="conversion-rate">0%</div>
                    <div class="stat-label">Close Rate</div>
                    <div class="stat-change positive" id="conversion-change">+5% improvement</div>
                </div>
            </div>
            
            <div class="stat-card revenue">
                <div class="stat-icon">💰</div>
                <div class="stat-content">
                    <div class="stat-value" id="monthly-revenue">$0</div>
                    <div class="stat-label">Monthly Revenue</div>
                    <div class="stat-change positive" id="revenue-change">On track</div>
                </div>
            </div>
        </div>

        <!-- Recent Activity & Lead Management -->
        <div class="admin-grid">
            <section class="admin-section recent-activity">
                <div class="section-header">
                    <div class="section-title">
                        <span class="section-icon">📝</span>
                        <h2>Recent Activity</h2>
                    </div>
                </div>
                
                <div class="activity-feed" id="activity-feed">
                    <!-- Activity items will be populated here -->
                </div>
            </section>
            
            <section class="admin-section lead-management">
                <div class="section-header">
                    <div class="section-title">
                        <span class="section-icon">⚙️</span>
                        <h2>Lead Management</h2>
                    </div>
                </div>
                
                <div class="management-actions">
                    <button class="action-btn" onclick="reassignLead()">
                        <span class="btn-icon">🔄</span>
                        <span class="btn-text">Reassign Lead</span>
                    </button>
                    
                    <button class="action-btn" onclick="bulkActions()">
                        <span class="btn-icon">📦</span>
                        <span class="btn-text">Bulk Actions</span>
                    </button>
                    
                    <button class="action-btn" onclick="leadImport()">
                        <span class="btn-icon">📥</span>
                        <span class="btn-text">Import Leads</span>
                    </button>
                    
                    <button class="action-btn" onclick="agentDashboard()">
                        <span class="btn-icon">👤</span>
                        <span class="btn-text">Agent View</span>
                    </button>
                </div>
            </section>
        </div>

        <!-- Publisher Management Section -->
        <section class="admin-section publisher-management">
            <div class="section-header">
                <div class="section-title">
                    <span class="section-icon">🏢</span>
                    <h2>Publisher Management</h2>
                    <span class="publisher-count" id="publisher-count">0 publishers</span>
                </div>
                <div class="section-actions">
                    <button class="btn btn-secondary" onclick="refreshPublishers()">🔄 Refresh</button>
                    <button class="btn btn-info" onclick="openAddPublisherModal()">➕ Add Publisher</button>
                    <button class="btn btn-warning" onclick="exportPublishers()">📊 Export</button>
                </div>
            </div>

            <!-- Publisher Stats Overview -->
            <div class="publisher-stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">🏢</div>
                    <div class="stat-content">
                        <div class="stat-value" id="total-publishers">0</div>
                        <div class="stat-label">Total Publishers</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">🟢</div>
                    <div class="stat-content">
                        <div class="stat-value" id="active-publishers">0</div>
                        <div class="stat-label">Active</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">📋</div>
                    <div class="stat-content">
                        <div class="stat-value" id="total-publisher-leads">0</div>
                        <div class="stat-label">Total Leads</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">💰</div>
                    <div class="stat-content">
                        <div class="stat-value" id="total-publisher-revenue">$0</div>
                        <div class="stat-label">Total Revenue</div>
                    </div>
                </div>
            </div>

            <!-- Publisher Filters -->
            <div class="publisher-filters">
                <div class="filter-group">
                    <input type="text" id="publisher-search" placeholder="Search publishers..." class="form-input">
                </div>
                <div class="filter-group">
                    <select id="publisher-status-filter" class="form-input">
                        <option value="">All Status</option>
                        <option value="active">Active</option>
                        <option value="inactive">Inactive</option>
                        <option value="pending">Pending</option>
                        <option value="suspended">Suspended</option>
                    </select>
                </div>
                <div class="filter-group">
                    <select id="publisher-sort" class="form-input">
                        <option value="name">Sort by Name</option>
                        <option value="revenue">Sort by Revenue</option>
                        <option value="leads">Sort by Leads</option>
                        <option value="created">Sort by Date</option>
                    </select>
                </div>
            </div>

            <!-- Publishers Table -->
            <div class="table-container">
                <table class="admin-table" id="publishers-table">
                    <thead>
                        <tr>
                            <th>
                                <input type="checkbox" id="select-all-publishers" onchange="toggleSelectAllPublishers()">
                            </th>
                            <th>Publisher</th>
                            <th>Status</th>
                            <th>Vendor Code</th>
                            <th>Tracking ID</th>
                            <th>API Key</th>
                            <th>Leads</th>
                            <th>Revenue</th>
                            <th>Last Activity</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="publishers-table-body">
                        <!-- Publishers will be populated here -->
                    </tbody>
                </table>
            </div>

            <!-- Bulk Actions Bar -->
            <div class="bulk-actions-bar" id="bulk-publishers-actions" style="display: none;">
                <div class="bulk-info">
                    <span id="selected-publishers-count">0</span> publishers selected
                </div>
                <div class="bulk-buttons">
                    <button class="btn btn-secondary" onclick="bulkActivatePublishers()">🟢 Activate</button>
                    <button class="btn btn-warning" onclick="bulkDeactivatePublishers()">🔴 Deactivate</button>
                    <button class="btn btn-info" onclick="bulkDownloadPdfs()">📄 Download PDFs</button>
                    <button class="btn btn-danger" onclick="bulkDeletePublishers()">🗑️ Delete</button>
                </div>
            </div>
        </section>
    </main>

    <!-- Add Agent Modal -->
    <div class="modal-overlay" id="add-agent-modal">
        <div class="modal glass-modal">
            <div class="modal-header">
                <h3 class="modal-title">Add New Agent</h3>
                <button class="modal-close" onclick="closeModal('add-agent-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Email Address</label>
                    <input type="email" id="new-agent-email" placeholder="agent@example.com" class="form-input">
                </div>
                <div class="form-group">
                    <label>Role</label>
                    <select id="new-agent-role" class="form-input">
                        <option value="agent">Agent - Manage leads</option>
                        <option value="viewer">Viewer - View only</option>
                        <option value="admin">Admin - Full access</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('add-agent-modal')">Cancel</button>
                <button class="btn btn-primary" onclick="handleSendAgentInvite()">Send Invite</button>
            </div>
        </div>
    </div>

    <!-- Add Publisher Modal -->
    <div class="modal-overlay" id="add-publisher-modal">
        <div class="modal glass-modal">
            <div class="modal-header">
                <h3 class="modal-title">Add New Publisher</h3>
                <button class="modal-close" onclick="closeModal('add-publisher-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Publisher Name</label>
                    <input type="text" id="new-publisher-name" placeholder="Publisher Name" class="form-input" required>
                </div>
                <div class="form-group">
                    <label>Contact Email</label>
                    <input type="email" id="new-publisher-email" placeholder="contact@publisher.com" class="form-input" required>
                </div>
                <div class="form-group">
                    <label>Vendor Code</label>
                    <input type="text" id="new-publisher-code" placeholder="AUTO-GENERATED" class="form-input" readonly>
                </div>
                <div class="form-group">
                    <label>API Key</label>
                    <input type="text" id="new-publisher-api-key" placeholder="AUTO-GENERATED" class="form-input" readonly>
                </div>
                <div class="form-group">
                    <label>Status</label>
                    <select id="new-publisher-status" class="form-input">
                        <option value="active">Active</option>
                        <option value="inactive">Inactive</option>
                        <option value="pending">Pending</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('add-publisher-modal')">Cancel</button>
                <button class="btn btn-primary" onclick="handleCreatePublisher()">Create Publisher</button>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script>
    // Publisher Management Functions
    let selectedPublishers = new Set();
    let allPublishers = [
        // Starting with empty array - no test data
    ];

    // Generate unique tracking ID for publisher traffic
    function generateTrackingId() {
        // Generate a unique 12-character tracking ID (TRK_XXXXXXXX)
        const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
        let trackingId = 'TRK_';
        for (let i = 0; i < 8; i++) {
            trackingId += chars.charAt(Math.floor(Math.random() * chars.length));
        }
        return trackingId;
    }

    function generateVendorCode() {
        const prefix = 'PUB';
        const timestamp = Date.now().toString().slice(-6);
        const random = Math.random().toString(36).substr(2, 4).toUpperCase();
        return prefix + timestamp + random;
    }

    function generateAPIKey() {
        return 'api_' + Math.random().toString(36).substr(2, 32);
    }

    function addActivityFeedItem(message, type = 'info') {
        const feed = document.getElementById('activity-feed');
        if (!feed) return;
        
        const activity = document.createElement('div');
        activity.className = 'activity-item';
        activity.innerHTML = `
            <div class="activity-icon ${type}">
                ${type === 'success' ? '✅' : type === 'error' ? '❌' : type === 'warning' ? '⚠️' : 'ℹ️'}
            </div>
            <div class="activity-content">
                <div class="activity-message">${message}</div>
                <div class="activity-time">${new Date().toLocaleTimeString()}</div>
            </div>
        `;
        
        feed.insertBefore(activity, feed.firstChild);
        
        // Keep only last 20 items
        const items = feed.querySelectorAll('.activity-item');
        if (items.length > 20) {
            items[items.length - 1].remove();
        }
    }

    // Publisher creation function with tracking ID
    window.handleCreatePublisher = function() {
        const name = document.getElementById('new-publisher-name').value;
        const email = document.getElementById('new-publisher-email').value;
        const vendorCode = document.getElementById('new-publisher-code').value;
        const apiKey = document.getElementById('new-publisher-api-key').value;
        const status = document.getElementById('new-publisher-status').value;
        
        if (!name || !email) {
            alert('Please fill in all required fields');
            return;
        }
        
        console.log('🏢 Creating publisher:', { name, email, vendorCode, apiKey, status });
        
        // Generate unique tracking ID for this publisher
        const trackingId = generateTrackingId();
        console.log('📊 Generated tracking ID:', trackingId);
        
        // Create new publisher object
        const newPublisher = {
            id: 'pub_' + Date.now(),
            name: name,
            email: email,
            vendorCode: vendorCode,
            apiKey: apiKey,
            trackingId: trackingId, // Add tracking ID for traffic monitoring
            status: status || 'pending',
            leads: 0,
            revenue: 0,
            lastActivity: new Date().toISOString()
        };
        
        // Add to publishers array
        allPublishers.push(newPublisher);
        
        // IMMEDIATELY update all displays
        setTimeout(() => {
            renderPublishersTable();
            updatePublisherStats();
            updatePublisherCount();
            console.log('✅ Publisher table updated with new publisher');
        }, 100);
        
        // Generate and download posting instructions and API documentation
        generatePublisherPackage(name, email, vendorCode, apiKey);
        
        // Generate PDF with proper error handling and timing
        setTimeout(() => {
            try {
                if (typeof window.jspdf !== 'undefined') {
                    downloadPublisherInstructionsAsPdf(name, email, vendorCode, apiKey);
                    addActivityFeedItem(`📄 PDF instructions generated for ${name}`, 'success');
                } else {
                    console.warn('jsPDF not loaded, skipping PDF generation');
                    addActivityFeedItem(`⚠️ PDF generation skipped - library not loaded`, 'warning');
                }
            } catch (error) {
                console.error('PDF generation failed:', error);
                addActivityFeedItem(`❌ PDF generation failed for ${name}`, 'error');
            }
        }, 1500);
        
        // Add activity feed items
        addActivityFeedItem(`🏢 Publisher "${name}" created successfully`, 'success');
        addActivityFeedItem(`📄 Publisher package downloaded for ${name}`, 'info');
        closeModal('add-publisher-modal');
    };

    function generatePublisherPackage(publisherName, email, vendorCode, apiKey) {
        // Generate comprehensive posting instructions and API documentation
        const publisherPackage = generatePublisherDocumentation(publisherName, email, vendorCode, apiKey);
        
        // Create downloadable ZIP file with all documentation
        if (typeof JSZip !== 'undefined') {
            const zip = new JSZip();
            
            // Add posting instructions
            zip.file("posting-instructions.html", publisherPackage.instructions);
            zip.file("api-documentation.md", publisherPackage.apiDocs);
            zip.file("integration-guide.txt", publisherPackage.integrationGuide);
            zip.file("sample-code.js", publisherPackage.sampleCode);
            zip.file("publisher-credentials.txt", publisherPackage.credentials);
            
            // Generate and download the ZIP file
            zip.generateAsync({type:"blob"}).then(function(content) {
                const link = document.createElement('a');
                link.href = URL.createObjectURL(content);
                link.download = `${publisherName.replace(/\s+/g, '-')}-publisher-package.zip`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                console.log('✅ Publisher package downloaded successfully');
            }).catch(function(error) {
                console.error('❌ Error generating ZIP file:', error);
                alert('Publisher created successfully! Package generation had an issue, but publisher is saved.');
            });
        } else {
            console.warn('JSZip not available, skipping package download');
            alert('Publisher created successfully! (Package download requires JSZip)');
        }
    }

    function generatePublisherDocumentation(publisherName, email, vendorCode, apiKey) {
        const baseUrl = window.APP_CONFIG?.apiEndpoint || 'https://9qtb4my1ij.execute-api.us-east-1.amazonaws.com/prod';
        
        // Find the publisher to get the tracking ID
        const publisher = allPublishers.find(p => p.name === publisherName && p.email === email);
        const trackingId = publisher?.trackingId || 'Not Available';
        
        const instructions = `
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Claim Connectors - Publisher Integration Guide</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; line-height: 1.6; }
        .header { background: linear-gradient(135deg, #3B82F6, #8B5CF6); color: white; padding: 30px; border-radius: 10px; text-align: center; margin-bottom: 30px; }
        .section { background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #3B82F6; }
        .code { background: #1e1e1e; color: #f8f8f2; padding: 15px; border-radius: 5px; font-family: 'Courier New', monospace; overflow-x: auto; }
        .warning { background: #fff3cd; border-left: 4px solid #ffc107; padding: 15px; border-radius: 5px; }
        table { width: 100%; border-collapse: collapse; margin: 15px 0; }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
        th { background-color: #3B82F6; color: white; }
    </style>
</head>
<body>
    <div class="header">
        <h1>🚀 Claim Connectors Publisher Integration</h1>
        <p>Welcome ${publisherName}! Your complete integration package</p>
    </div>

    <div class="section">
        <h2>📋 Your Publisher Credentials</h2>
        <table>
            <tr><th>Field</th><th>Value</th></tr>
            <tr><td>Publisher Name</td><td>${publisherName}</td></tr>
            <tr><td>Contact Email</td><td>${email}</td></tr>
            <tr><td>Vendor Code</td><td><strong>${vendorCode}</strong></td></tr>
            <tr><td>Tracking ID</td><td><strong>${trackingId}</strong></td></tr>
            <tr><td>API Key</td><td><strong>${apiKey}</strong></td></tr>
            <tr><td>API Endpoint</td><td>${baseUrl}</td></tr>
        </table>
        <div class="warning">
            <strong>⚠️ Important:</strong> Keep your API key secure and never share it publicly.
        </div>
    </div>

    <div class="section">
        <h2>🔗 Lead Posting Instructions</h2>
        <p>To send leads to Claim Connectors, POST to our lead submission endpoint:</p>
        
        <h3>Endpoint:</h3>
        <div class="code">POST ${baseUrl}/leads</div>
        
        <h3>Headers Required:</h3>
        <div class="code">
Content-Type: application/json
X-API-Key: ${apiKey}
X-Vendor-Code: ${vendorCode}
        </div>
        
        <h3>Lead Data Format:</h3>
        <div class="code">
{
  "first_name": "John",
  "last_name": "Smith", 
  "email": "john.smith@email.com",
  "phone_home": "(555) 123-4567",
  "state": "CA",
  "incident_type": "auto_accident",
  "vendor_code": "${vendorCode}"
}
        </div>
    </div>

    <div class="success">
        <h3>✅ Integration Complete!</h3>
        <p>Once implemented, leads will flow directly into our system.</p>
    </div>
</body>
</html>`;

        const apiDocs = `# Claim Connectors API Documentation

## Publisher: ${publisherName}
## Generated: ${new Date().toISOString()}

### Authentication
- **API Key:** ${apiKey}
- **Vendor Code:** ${vendorCode}
- **Tracking ID:** ${trackingId}

### Endpoints

#### Submit Lead
POST ${baseUrl}/leads
Content-Type: application/json
X-API-Key: ${apiKey}
X-Vendor-Code: ${vendorCode}

### Field Validation Rules
- **email**: Must be valid email format
- **phone_home**: US phone number format
- **state**: Must be valid US state code

### Rate Limits
- Maximum 100 requests per minute
- Maximum 10,000 leads per day

### Error Codes
- 400: Bad Request (validation error)
- 401: Unauthorized (invalid API key)
- 429: Rate limit exceeded
- 500: Internal server error`;

        const sampleCode = `// Claim Connectors Lead Submission - JavaScript Example
// Publisher: ${publisherName}

const CLAIM_CONNECTORS_CONFIG = {
    apiEndpoint: '${baseUrl}',
    apiKey: '${apiKey}',
    vendorCode: '${vendorCode}',
    trackingId: '${trackingId}'
};

async function submitLead(leadData) {
    try {
        const response = await fetch(\`\${CLAIM_CONNECTORS_CONFIG.apiEndpoint}/leads\`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-API-Key': CLAIM_CONNECTORS_CONFIG.apiKey,
                'X-Vendor-Code': CLAIM_CONNECTORS_CONFIG.vendorCode,
                'X-Tracking-ID': CLAIM_CONNECTORS_CONFIG.trackingId
            },
            body: JSON.stringify({
                ...leadData,
                vendor_code: CLAIM_CONNECTORS_CONFIG.vendorCode,
                tracking_id: CLAIM_CONNECTORS_CONFIG.trackingId,
                source: '${publisherName}'
            })
        });

        const result = await response.json();
        
        if (response.ok) {
            console.log('Lead submitted successfully:', result);
            return { success: true, data: result };
        } else {
            console.error('Lead submission failed:', result);
            return { success: false, error: result };
        }
    } catch (error) {
        console.error('Network error:', error);
        return { success: false, error: error.message };
    }
}`;

        const credentials = `CLAIM CONNECTORS PUBLISHER CREDENTIALS
=====================================

Publisher Name: ${publisherName}
Contact Email: ${email}
Vendor Code: ${vendorCode}
Tracking ID: ${trackingId}
API Key: ${apiKey}
API Endpoint: ${baseUrl}

IMPORTANT SECURITY NOTES:
- Never share your API key publicly
- Use HTTPS for all API requests  
- Store credentials securely
- Use your Tracking ID for traffic analytics

Support Contact:
Email: publishers@claimconnectors.com
Phone: (555) CLAIM-01`;

        return {
            instructions,
            apiDocs,
            integrationGuide: "Complete integration guide and API documentation provided",
            sampleCode,
            credentials
        };
    }

    // Download publisher instructions as PDF
    function downloadPublisherInstructionsAsPdf(publisherName, email, vendorCode, apiKey) {
        const { jsPDF } = window.jspdf;
        const baseUrl = window.APP_CONFIG?.apiEndpoint || 'https://9qtb4my1ij.execute-api.us-east-1.amazonaws.com/prod';
        
        // Find the publisher to get the tracking ID
        const publisher = allPublishers.find(p => p.name === publisherName && p.email === email);
        const trackingId = publisher?.trackingId || 'Not Available';
        
        try {
            // Create a new PDF document
            const doc = new jsPDF({
                orientation: 'portrait',
                unit: 'mm',
                format: 'a4'
            });
            
            // Add header
            doc.setFontSize(20);
            doc.setFont(undefined, 'bold');
            doc.text('Claim Connectors - API Integration', 20, 25);
            
            doc.setFontSize(16);
            doc.text(`Publisher: ${publisherName}`, 20, 35);
            
            // Add publisher credentials section
            doc.setFontSize(14);
            doc.setFont(undefined, 'bold');
            doc.text('Publisher Credentials', 20, 50);
            
            doc.setFontSize(10);
            doc.setFont(undefined, 'normal');
            doc.text(`Publisher Name: ${publisherName}`, 25, 60);
            doc.text(`Contact Email: ${email}`, 25, 67);
            doc.text(`Vendor Code: ${vendorCode}`, 25, 74);
            doc.text(`Tracking ID: ${trackingId}`, 25, 81);
            doc.text(`API Key: ${apiKey}`, 25, 88);
            doc.text(`API Endpoint: ${baseUrl}`, 25, 95);
            
            // Add warning box
            doc.setFontSize(9);
            doc.setFont(undefined, 'bold');
            doc.text('⚠️ IMPORTANT: Keep your API key secure and never share it publicly.', 25, 105);
            
            // Add API instructions section
            doc.setFontSize(14);
            doc.setFont(undefined, 'bold');
            doc.text('Lead Submission Instructions', 20, 122);
            
            doc.setFontSize(10);
            doc.setFont(undefined, 'normal');
            doc.text('To send leads to Claim Connectors, POST to our lead submission endpoint:', 25, 132);
            
            // Endpoint
            doc.setFontSize(12);
            doc.setFont(undefined, 'bold');
            doc.text('Endpoint:', 25, 142);
            doc.setFont(undefined, 'normal');
            doc.text(`POST ${baseUrl}/leads`, 25, 149);
            
            // Headers
            doc.setFont(undefined, 'bold');
            doc.text('Required Headers:', 25, 159);
            doc.setFont(undefined, 'normal');
            doc.text('Content-Type: application/json', 25, 166);
            doc.text(`X-API-Key: ${apiKey}`, 25, 173);
            doc.text(`X-Vendor-Code: ${vendorCode}`, 25, 180);
            
            // Sample payload
            doc.setFont(undefined, 'bold');
            doc.text('Sample Lead Data:', 25, 190);
            
            doc.setFont('courier', 'normal');
            doc.setFontSize(8);
            const samplePayload = [
                '{',
                '  "first_name": "John",',
                '  "last_name": "Smith",',
                '  "email": "john.smith@email.com",',
                '  "phone_home": "(555) 123-4567",',
                '  "state": "CA",',
                '  "incident_type": "auto_accident",',
                `  "vendor_code": "${vendorCode}"`,
                '}'
            ];
            
            let yPos = 197;
            samplePayload.forEach(line => {
                doc.text(line, 25, yPos);
                yPos += 5;
            });
            
            // Add response format
            doc.setFont(undefined, 'bold');
            doc.setFontSize(10);
            doc.text('Success Response Format:', 25, yPos + 10);
            
            doc.setFont('courier', 'normal');
            doc.setFontSize(8);
            yPos += 17;
            const responseFormat = [
                '{',
                '  "status": "success",',
                '  "lead_id": "uuid-string",',
                '  "message": "Lead received"',
                '}'
            ];
            
            responseFormat.forEach(line => {
                doc.text(line, 25, yPos);
                yPos += 5;
            });
            
            // Add support information
            doc.setFont(undefined, 'bold');
            doc.setFontSize(10);
            doc.text('Support Contact:', 25, yPos + 15);
            doc.setFont(undefined, 'normal');
            doc.text('Email: publishers@claimconnectors.com', 25, yPos + 22);
            doc.text('Phone: (555) CLAIM-01', 25, yPos + 29);
            
            // Add footer
            doc.setFontSize(8);
            doc.setTextColor(128, 128, 128);
            doc.text(`Generated on: ${new Date().toLocaleString()}`, 20, 280);
            doc.text('Claim Connectors - Lead Management System', 20, 285);
            
            // Generate the PDF filename
            const filename = `${publisherName.replace(/[^a-zA-Z0-9]/g, '_')}_API_Instructions.pdf`;
            
            // Save the PDF
            doc.save(filename);
            
            console.log('✅ Publisher PDF instructions downloaded successfully');
            
        } catch (err) {
            console.error('Failed to generate PDF: ', err);
            alert('Failed to generate PDF. Please try again.');
        }
    }

    function loadPublishers() {
        renderPublishersTable();
        updatePublisherStats();
        updatePublisherCount();
    }

    function renderPublishersTable(publishers = allPublishers) {
        const tbody = document.getElementById('publishers-table-body');
        if (!tbody) return;

        tbody.innerHTML = publishers.map(publisher => `
            <tr>
                <td>
                    <input type="checkbox" onchange="togglePublisherSelection('${publisher.id}', this.checked)">
                </td>
                <td>
                    <div class="publisher-info">
                        <div class="publisher-name">${publisher.name}</div>
                        <div class="publisher-email">${publisher.email}</div>
                    </div>
                </td>
                <td>
                    <span class="status-badge ${publisher.status}">${publisher.status.toUpperCase()}</span>
                </td>
                <td>
                    <span class="vendor-code">${publisher.vendorCode}</span>
                </td>
                <td>
                    <span class="vendor-code">${publisher.trackingId || 'Not Generated'}</span>
                </td>
                <td>
                    <div class="api-key-display ${!publisher.apiKey ? 'no-key' : ''}">
                        ${publisher.apiKey ? publisher.apiKey.substring(0, 8) + '...' : 'No API Key'}
                    </div>
                </td>
                <td>${publisher.leads.toLocaleString()}</td>
                <td>$${publisher.revenue.toLocaleString()}</td>
                <td>${publisher.lastActivity ? formatTimeAgo(publisher.lastActivity) : 'Never'}</td>
                <td>
                    <div class="action-buttons">
                        <button class="action-btn-sm view" onclick="viewPublisher('${publisher.id}')" title="View Details">👁️</button>
                        <button class="action-btn-sm edit" onclick="editPublisher('${publisher.id}')" title="Edit">✏️</button>
                        <button class="action-btn-sm pdf" onclick="downloadPublisherPdf('${publisher.id}')" title="Download PDF">📄</button>
                        ${publisher.apiKey ? 
                            `<button class="action-btn-sm api" onclick="regenerateApiKey('${publisher.id}')" title="Regenerate API">🔄</button>` :
                            `<button class="action-btn-sm api" onclick="generateApiKey('${publisher.id}')" title="Generate API">🔑</button>`
                        }
                        <button class="action-btn-sm toggle" onclick="togglePublisherStatus('${publisher.id}')" title="Toggle Status">
                            ${publisher.status === 'active' ? '🔴' : '🟢'}
                        </button>
                        <button class="action-btn-sm delete" onclick="deletePublisher('${publisher.id}')" title="Delete">🗑️</button>
                    </div>
                </td>
            </tr>
        `).join('');
    }

    function updatePublisherStats() {
        const activePublishers = allPublishers.filter(p => p.status === 'active').length;
        const totalLeads = allPublishers.reduce((sum, p) => sum + p.leads, 0);
        const totalRevenue = allPublishers.reduce((sum, p) => sum + p.revenue, 0);

        document.getElementById('total-publishers').textContent = allPublishers.length;
        document.getElementById('active-publishers').textContent = activePublishers;
        document.getElementById('total-publisher-leads').textContent = totalLeads.toLocaleString();
        document.getElementById('total-publisher-revenue').textContent = '$' + totalRevenue.toLocaleString();
    }

    function updatePublisherCount() {
        const count = document.getElementById('publisher-count');
        if (count) {
            count.textContent = `${allPublishers.length} publishers`;
        }
    }

    function formatTimeAgo(dateString) {
        const now = new Date();
        const date = new Date(dateString);
        const diffInMinutes = Math.floor((now - date) / (1000 * 60));
        
        if (diffInMinutes < 60) return `${diffInMinutes}m ago`;
        if (diffInMinutes < 1440) return `${Math.floor(diffInMinutes / 60)}h ago`;
        return `${Math.floor(diffInMinutes / 1440)}d ago`;
    }

    // Publisher Action Functions
    function viewPublisher(id) {
        const publisher = allPublishers.find(p => p.id === id);
        if (publisher) {
            alert(`Publisher Details:\n\nName: ${publisher.name}\nEmail: ${publisher.email}\nStatus: ${publisher.status}\nTracking ID: ${publisher.trackingId}\nLeads: ${publisher.leads}\nRevenue: $${publisher.revenue}`);
        }
    }

    function editPublisher(id) {
        const publisher = allPublishers.find(p => p.id === id);
        if (publisher) {
            const newName = prompt('Edit Publisher Name:', publisher.name);
            if (newName && newName !== publisher.name) {
                publisher.name = newName;
                renderPublishersTable();
                addActivityFeedItem(`📝 Publisher "${newName}" updated`, 'info');
            }
        }
    }

    function downloadPublisherPdf(id) {
        const publisher = allPublishers.find(p => p.id === id);
        if (publisher && publisher.apiKey) {
            downloadPublisherInstructionsAsPdf(publisher.name, publisher.email, publisher.vendorCode, publisher.apiKey);
            addActivityFeedItem(`📄 PDF downloaded for ${publisher.name}`, 'success');
        } else {
            alert('No API key available for this publisher');
        }
    }

    function regenerateApiKey(id) {
        const publisher = allPublishers.find(p => p.id === id);
        if (publisher && confirm(`Regenerate API key for ${publisher.name}?`)) {
            publisher.apiKey = generateAPIKey();
            renderPublishersTable();
            addActivityFeedItem(`🔄 API key regenerated for ${publisher.name}`, 'success');
        }
    }

    function generateApiKey(id) {
        const publisher = allPublishers.find(p => p.id === id);
        if (publisher) {
            publisher.apiKey = generateAPIKey();
            renderPublishersTable();
            addActivityFeedItem(`🔑 API key generated for ${publisher.name}`, 'success');
        }
    }

    function togglePublisherStatus(id) {
        const publisher = allPublishers.find(p => p.id === id);
        if (publisher) {
            publisher.status = publisher.status === 'active' ? 'inactive' : 'active';
            renderPublishersTable();
            updatePublisherStats();
            addActivityFeedItem(`🔄 ${publisher.name} status changed to ${publisher.status}`, 'info');
        }
    }

    function deletePublisher(id) {
        const publisher = allPublishers.find(p => p.id === id);
        if (publisher && confirm(`Delete publisher "${publisher.name}"?`)) {
            allPublishers = allPublishers.filter(p => p.id !== id);
            renderPublishersTable();
            updatePublisherStats();
            updatePublisherCount();
            addActivityFeedItem(`🗑️ Publisher "${publisher.name}" deleted`, 'warning');
        }
    }

    function togglePublisherSelection(id, checked) {
        if (checked) {
            selectedPublishers.add(id);
        } else {
            selectedPublishers.delete(id);
        }
        updateBulkActionsVisibility();
    }

    function toggleSelectAllPublishers() {
        const checkbox = document.getElementById('select-all-publishers');
        const allCheckboxes = document.querySelectorAll('#publishers-table-body input[type="checkbox"]');
        
        allCheckboxes.forEach(cb => {
            cb.checked = checkbox.checked;
            const id = cb.onchange.toString().match(/'([^']+)'/)[1];
            if (checkbox.checked) {
                selectedPublishers.add(id);
            } else {
                selectedPublishers.delete(id);
            }
        });
        updateBulkActionsVisibility();
    }

    function updateBulkActionsVisibility() {
        const bulkBar = document.getElementById('bulk-publishers-actions');
        const count = document.getElementById('selected-publishers-count');
        
        if (bulkBar && count) {
            bulkBar.style.display = selectedPublishers.size > 0 ? 'flex' : 'none';
            count.textContent = selectedPublishers.size;
        }
    }

    // Bulk Actions
    function bulkActivatePublishers() {
        const selectedIds = Array.from(selectedPublishers);
        selectedIds.forEach(id => {
            const publisher = allPublishers.find(p => p.id === id);
            if (publisher) publisher.status = 'active';
        });
        renderPublishersTable();
        updatePublisherStats();
        selectedPublishers.clear();
        updateBulkActionsVisibility();
        addActivityFeedItem(`🟢 ${selectedIds.length} publishers activated`, 'success');
    }

    function bulkDeactivatePublishers() {
        const selectedIds = Array.from(selectedPublishers);
        selectedIds.forEach(id => {
            const publisher = allPublishers.find(p => p.id === id);
            if (publisher) publisher.status = 'inactive';
        });
        renderPublishersTable();
        updatePublisherStats();
        selectedPublishers.clear();
        updateBulkActionsVisibility();
        addActivityFeedItem(`🔴 ${selectedIds.length} publishers deactivated`, 'warning');
    }

    function bulkDownloadPdfs() {
        const selectedIds = Array.from(selectedPublishers);
        let downloadCount = 0;
        
        selectedIds.forEach(id => {
            const publisher = allPublishers.find(p => p.id === id);
            if (publisher && publisher.apiKey) {
                setTimeout(() => {
                    downloadPublisherInstructionsAsPdf(publisher.name, publisher.email, publisher.vendorCode, publisher.apiKey);
                }, downloadCount * 500);
                downloadCount++;
            }
        });
        
        if (downloadCount > 0) {
            addActivityFeedItem(`📄 ${downloadCount} PDFs downloaded`, 'success');
        } else {
            alert('No publishers with API keys selected');
        }
    }

    function bulkDeletePublishers() {
        const selectedIds = Array.from(selectedPublishers);
        if (confirm(`Delete ${selectedIds.length} selected publishers?`)) {
            allPublishers = allPublishers.filter(p => !selectedIds.includes(p.id));
            renderPublishersTable();
            updatePublisherStats();
            updatePublisherCount();
            selectedPublishers.clear();
            updateBulkActionsVisibility();
            addActivityFeedItem(`🗑️ ${selectedIds.length} publishers deleted`, 'warning');
        }
    }

    // Global Functions
    function refreshPublishers() {
        loadPublishers();
        addActivityFeedItem('🔄 Publishers refreshed', 'info');
    }

    function exportPublishers() {
        const csvContent = "data:text/csv;charset=utf-8," + 
            "Name,Email,Vendor Code,Tracking ID,Status,Leads,Revenue\n" +
            allPublishers.map(p => `"${p.name}","${p.email}","${p.vendorCode}","${p.trackingId}","${p.status}",${p.leads},${p.revenue}`).join("\n");
        
        const link = document.createElement("a");
        link.setAttribute("href", encodeURI(csvContent));
        link.setAttribute("download", "publishers_export.csv");
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        
        addActivityFeedItem('📊 Publishers exported to CSV', 'success');
    }

    // Filter Functions
    function filterPublishers() {
        const search = document.getElementById('publisher-search').value.toLowerCase();
        const statusFilter = document.getElementById('publisher-status-filter').value;
        
        let filtered = allPublishers.filter(publisher => {
            const matchesSearch = publisher.name.toLowerCase().includes(search) || 
                                publisher.email.toLowerCase().includes(search);
            const matchesStatus = !statusFilter || publisher.status === statusFilter;
            return matchesSearch && matchesStatus;
        });

        renderPublishersTable(filtered);
    }

    function sortPublishers() {
        const sortBy = document.getElementById('publisher-sort').value;
        
        allPublishers.sort((a, b) => {
            switch(sortBy) {
                case 'name':
                    return a.name.localeCompare(b.name);
                case 'revenue':
                    return b.revenue - a.revenue;
                case 'leads':
                    return b.leads - a.leads;
                case 'created':
                    return new Date(b.lastActivity || 0) - new Date(a.lastActivity || 0);
                default:
                    return 0;
            }
        });
        
        renderPublishersTable();
    }

    // Expose all functions globally
    window.viewPublisher = viewPublisher;
    window.editPublisher = editPublisher;
    window.downloadPublisherPdf = downloadPublisherPdf;
    window.regenerateApiKey = regenerateApiKey;
    window.generateApiKey = generateApiKey;
    window.togglePublisherStatus = togglePublisherStatus;
    window.deletePublisher = deletePublisher;
    window.togglePublisherSelection = togglePublisherSelection;
    window.toggleSelectAllPublishers = toggleSelectAllPublishers;
    window.bulkActivatePublishers = bulkActivatePublishers;
    window.bulkDeactivatePublishers = bulkDeactivatePublishers;
    window.bulkDownloadPdfs = bulkDownloadPdfs;
    window.bulkDeletePublishers = bulkDeletePublishers;
    window.refreshPublishers = refreshPublishers;
    window.exportPublishers = exportPublishers;
    window.generatePublisherPackage = generatePublisherPackage;
    window.generatePublisherDocumentation = generatePublisherDocumentation;
    window.downloadPublisherInstructionsAsPdf = downloadPublisherInstructionsAsPdf;

    // Navigation functions for admin dashboard
    function exportLeadData() {
        console.log('📊 Exporting lead data...');
        addActivityFeedItem('📊 Lead export started', 'info');
    }

    function refreshOverview() {
        console.log('🔄 Refreshing overview...');
        addActivityFeedItem('🔄 Overview data refreshed', 'success');
    }

    function viewAvailableLeads() {
        console.log('🔍 Viewing available leads...');
        addActivityFeedItem('👁️ Available leads view opened', 'info');
    }

    function viewClaimedLeads() {
        alert('Claimed Leads View - Coming Soon!');
        addActivityFeedItem('👁️ Claimed leads view opened', 'info');
    }

    function showAnalyticsDetails() {
        console.log('📈 Opening analytics details...');
        addActivityFeedItem('📈 Analytics feature temporarily disabled', 'info');
    }

    function reassignLead() {
        alert('Reassign Lead - Coming Soon!');
        addActivityFeedItem('🔄 Lead reassignment opened', 'info');
    }

    function bulkActions() {
        alert('Bulk Actions - Coming Soon!');
        addActivityFeedItem('📦 Bulk actions opened', 'info');
    }

    function agentDashboard() {
        alert('Agent Dashboard - Coming Soon!');
        addActivityFeedItem('👤 Agent dashboard opened', 'info');
    }

    function leadImport() {
        alert('Lead Import - Coming Soon!');
        addActivityFeedItem('📥 Lead import opened', 'info');
    }

    // Expose navigation functions globally
    window.exportLeadData = exportLeadData;
    window.refreshOverview = refreshOverview;
    window.viewAvailableLeads = viewAvailableLeads;
    window.viewClaimedLeads = viewClaimedLeads;
    window.showAnalyticsDetails = showAnalyticsDetails;
    window.reassignLead = reassignLead;
    window.bulkActions = bulkActions;
    window.agentDashboard = agentDashboard;
    window.leadImport = leadImport;

    // Initialize dashboard
    document.addEventListener('DOMContentLoaded', function() {
        // Update date and time
        function updateDateTime() {
            const now = new Date();
            const hour = now.getHours();
            let greeting = 'morning';
            
            if (hour >= 12 && hour < 17) greeting = 'afternoon';
            else if (hour >= 17) greeting = 'evening';
            
            const greetingEl = document.getElementById('time-greeting');
            const dateEl = document.getElementById('current-date');
            
            if (greetingEl) greetingEl.textContent = greeting;
            if (dateEl) {
                dateEl.textContent = now.toLocaleDateString('en-US', {
                    weekday: 'long',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
            }
        }
        
        updateDateTime();
        setInterval(updateDateTime, 60000); // Update every minute

        // Add event listeners for publisher filters
        setTimeout(() => {
            const searchInput = document.getElementById('publisher-search');
            const statusFilter = document.getElementById('publisher-status-filter');
            const sortSelect = document.getElementById('publisher-sort');
            
            if (searchInput) searchInput.addEventListener('input', filterPublishers);
            if (statusFilter) statusFilter.addEventListener('change', filterPublishers);
            if (sortSelect) sortSelect.addEventListener('change', sortPublishers);
            
            // Load initial data
            console.log('🏢 Loading initial publisher data...');
            loadPublishers();
            console.log('✅ Publisher management initialized');
        }, 1000);
        
        // Initialize with some mock data
        setTimeout(() => {
            addActivityFeedItem('🎯 Admin dashboard initialized', 'success');
            addActivityFeedItem('🏢 Publisher management ready', 'info');
        }, 2000);
        
        console.log('🎯 Enhanced admin dashboard initialized');
    });
    </script>
</body>
</html>
